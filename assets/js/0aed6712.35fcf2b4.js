"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[346],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>k});var a=n(67294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,o=e.originalType,p=e.parentName,d=r(e,["components","mdxType","originalType","parentName"]),u=s(n),c=l,k=u["".concat(p,".").concat(c)]||u[c]||m[c]||o;return n?a.createElement(k,i(i({ref:t},d),{},{components:n})):a.createElement(k,i({ref:t},d))}));function k(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var o=n.length,i=new Array(o);i[0]=c;var r={};for(var p in t)hasOwnProperty.call(t,p)&&(r[p]=t[p]);r.originalType=e,r[u]="string"==typeof e?e:l,i[1]=r;for(var s=2;s<o;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},46300:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(67294),l=n(50012);function o(e){let{path:t}=e;const[n]=(0,l.Nk)("docusaurus.tab.js-ts"),o=t.lastIndexOf("{"),i=t.slice(o+1,t.length-1),[r,p]=i.split(","),s=t.slice(0,o);return a.createElement("code",null,s+("js"===n?r:p))}},87587:(e,t,n)=>{n.d(t,{Fi:()=>r,Jp:()=>o,Vp:()=>l,aH:()=>i});var a=n(67294);const l=e=>{let{color:t,children:n}=e;return a.createElement("span",{style:{border:`2px solid ${t}`,display:"inline-block",padding:"0.2em 0.4em",color:t,borderRadius:"0.4em",fontSize:"0.8em",lineHeight:"1",fontWeight:"bold"}},n)};function o(){return a.createElement(l,{color:"#0b62f5"},"internal")}function i(){return a.createElement(l,{color:"#f59e0b"},"required")}function r(){return a.createElement(l,{color:"#08c47e"},"optional")}},97300:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>N,contentTitle:()=>f,default:()=>C,frontMatter:()=>y,metadata:()=>g,toc:()=>b});var a=n(87462),l=n(67294),o=n(3905);n(46300),n(44996);const i={toc:[]},r="wrapper";function p(e){let{components:t,...n}=e;return(0,o.kt)(r,(0,a.Z)({},i,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("admonition",{title:"Using an external auth method?",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"If your app is using an external authentication method(s) supported by Wasp (such as ",(0,o.kt)("a",{parentName:"p",href:"/docs/auth/social-auth/google#4-adding-environment-variables"},"Google")," or ",(0,o.kt)("a",{parentName:"p",href:"/docs/auth/social-auth/github#4-adding-environment-variables"},"GitHub"),"), make sure to additionally set the necessary environment variables specifically required by these method(s).")))}p.isMDXComponent=!0;const s={toc:[]},d="wrapper";function u(e){let{components:t,...n}=e;return(0,o.kt)(d,(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"To build the web app, position yourself in ",(0,o.kt)("inlineCode",{parentName:"p"},".wasp/build/web-app")," directory:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cd .wasp/build/web-app\n")),(0,o.kt)("p",null,"Run"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"npm install && REACT_APP_API_URL=<url_to_wasp_backend> npm run build\n")),(0,o.kt)("p",null,"where ",(0,o.kt)("inlineCode",{parentName:"p"},"<url_to_wasp_backend>")," is the URL of the Wasp server that you previously deployed."),(0,o.kt)("admonition",{title:"Client Env Variables",type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Remember, if you have defined any other ",(0,o.kt)("a",{parentName:"p",href:"/docs/project/env-vars#defining-env-vars-in-development"},"client-side env variables")," in your project, make sure to add them to the command above when ",(0,o.kt)("a",{parentName:"p",href:"/docs/deployment/env-vars#client-env-vars"},"building your client"))))}u.isMDXComponent=!0;var m=n(87587);function c(){return l.createElement(m.Vp,{color:"#0284c7"},"server")}function k(){return l.createElement(m.Vp,{color:"#f97316"},"client")}function h(){return l.createElement(m.Vp,{color:"#a855f7"},"database")}const y={title:"Platform as a Service (PaaS)"},f=void 0,g={unversionedId:"deployment/deployment-methods/paas",id:"version-0.16.0/deployment/deployment-methods/paas",title:"Platform as a Service (PaaS)",description:"This document explains how to build and prepare your Wasp app for deployment.",source:"@site/versioned_docs/version-0.16.0/deployment/deployment-methods/paas.md",sourceDirName:"deployment/deployment-methods",slug:"/deployment/deployment-methods/paas",permalink:"/docs/deployment/deployment-methods/paas",draft:!1,editUrl:"https://github.com/wasp-lang/wasp/edit/release/web/versioned_docs/version-0.16.0/deployment/deployment-methods/paas.md",tags:[],version:"0.16.0",frontMatter:{title:"Platform as a Service (PaaS)"},sidebar:"docs",previous:{title:"Wasp CLI",permalink:"/docs/deployment/deployment-methods/cli"},next:{title:"Self-Hosted",permalink:"/docs/deployment/deployment-methods/self-hosted"}},N={},b=[{value:"Deploying a Wasp App",id:"deploying-a-wasp-app",level:2},{value:"1. Generating Deployable Code",id:"1-generating-deployable-code",level:3},{value:"2. Deploying the API Server <Server />",id:"2-deploying-the-api-server-",level:3},{value:"3. Deploying the Web Client <Client />",id:"3-deploying-the-web-client-",level:3},{value:"4. Deploying the Database <Database />",id:"4-deploying-the-database-",level:3},{value:"Different Providers",id:"different-providers",level:2},{value:"Fly.io <Server /> <Database />",id:"flyio",level:2},{value:"Set Up a Fly.io App",id:"set-up-a-flyio-app",level:3},{value:"Deploy to a Fly.io App",id:"deploy-to-a-flyio-app",level:3},{value:"Redeploying After Wasp Builds",id:"redeploying-after-wasp-builds",level:3},{value:"Railway <Server /> <Client /> <Database />",id:"railway",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Create New Project",id:"create-new-project",level:3},{value:"Deploy Your App to Railway",id:"deploy-your-app-to-railway",level:3},{value:"Setup Domains",id:"setup-domains",level:4},{value:"Deploying the Server",id:"deploying-the-server",level:4},{value:"Deploying the Client",id:"deploying-the-client",level:4},{value:"Conclusion",id:"conclusion",level:4},{value:"Updates &amp; Redeploying",id:"updates--redeploying",level:3},{value:"Heroku <Server /> <Database />",id:"heroku",level:2},{value:"Set up a Heroku app",id:"set-up-a-heroku-app",level:3},{value:"Deploy the Heroku app",id:"deploy-the-heroku-app",level:3},{value:"Netlify <Client />",id:"netlify",level:2},{value:"Deploying through Github Actions",id:"deploying-through-github-actions",level:3},{value:"Cloudflare <Client />",id:"cloudflare",level:2},{value:"Deploying through Github Actions",id:"deploying-through-github-actions-1",level:3}],w={toc:b},v="wrapper";function C(e){let{components:t,...l}=e;return(0,o.kt)(v,(0,a.Z)({},w,l,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"This document explains how to build and prepare your Wasp app for deployment.\nYou can then deploy the built Wasp app wherever and however you want, as long as your provider/server supports Wasp's build format."),(0,o.kt)("p",null,"After going through the general steps that apply to all deployments, you can\nfollow step-by-step guides for deploying your Wasp app to the most popular\nproviders:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#flyio"},"Fly.io")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#railway"},"Railway")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#heroku"},"Heroku")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#netlify"},"Netlify")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#cloudflare"},"Cloudflare"))),(0,o.kt)("p",null,"No worries, you can still deploy your app if your desired provider isn't on the\nlist - it just means we don't yet have a step-by-step guide for you to follow.\nFeel free to ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wasp-lang/wasp/edit/release/web/docs/deployment/deployment-methods/paas.md"},"open a\nPR"),"\nif you'd like to write one yourself :)"),(0,o.kt)("h2",{id:"deploying-a-wasp-app"},"Deploying a Wasp App"),(0,o.kt)("p",null,"Deploying a Wasp app comes down to the following:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Generating deployable code."),(0,o.kt)("li",{parentName:"ol"},"Deploying the API server (backend)."),(0,o.kt)("li",{parentName:"ol"},"Deploying the web client (frontend)."),(0,o.kt)("li",{parentName:"ol"},"Deploying a PostgreSQL database and keeping it running.")),(0,o.kt)("p",null,"Let's go through each of these steps."),(0,o.kt)("h3",{id:"1-generating-deployable-code"},"1. Generating Deployable Code"),(0,o.kt)("p",null,"Running the command ",(0,o.kt)("inlineCode",{parentName:"p"},"wasp build")," generates deployable code for the whole app in the ",(0,o.kt)("inlineCode",{parentName:"p"},".wasp/build/")," directory."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"wasp build\n")),(0,o.kt)("admonition",{title:"PostgreSQL in production",type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"You won't be able to build the app if you are using SQLite as a database (which is the default database).\nYou'll have to ",(0,o.kt)("a",{parentName:"p",href:"../../data-model/backends#migrating-from-sqlite-to-postgresql"},"switch to PostgreSQL")," before deploying to production.")),(0,o.kt)("h3",{id:"2-deploying-the-api-server-"},"2. Deploying the API Server ",(0,o.kt)(c,{mdxType:"Server"})),(0,o.kt)("p",null,"There's a Dockerfile that defines an image for building the server in the ",(0,o.kt)("inlineCode",{parentName:"p"},".wasp/build")," directory."),(0,o.kt)("p",null,"To run the server in production, deploy this Docker image to a hosting provider and make sure the required env variables are correctly set up. Usually, you use the provider's dashboard UI or a CLI tool to set up these env variables."),(0,o.kt)("p",null,"Check the ",(0,o.kt)("a",{parentName:"p",href:"/docs/deployment/env-vars#server-env-vars"},"required server env variables")," and make sure they are set up for your server."),(0,o.kt)("p",null,"While these are the general instructions on deploying the server anywhere, we also have more detailed instructions for chosen providers below, so check that out for more guidance if you are deploying to one of those providers."),(0,o.kt)("h3",{id:"3-deploying-the-web-client-"},"3. Deploying the Web Client ",(0,o.kt)(k,{mdxType:"Client"})),(0,o.kt)(u,{mdxType:"BuildingTheWebClient"}),(0,o.kt)("p",null,"The command above will build the web client and put it in the ",(0,o.kt)("inlineCode",{parentName:"p"},"build/")," directory in the ",(0,o.kt)("inlineCode",{parentName:"p"},".wasp/build/web-app/"),"."),(0,o.kt)("p",null,"Since the result of building is just a bunch of static files, you can now deploy your web client to any static hosting provider (e.g. Netlify, Cloudflare, ...) by deploying the contents of ",(0,o.kt)("inlineCode",{parentName:"p"},".wasp/build/web-app/build/"),"."),(0,o.kt)("h3",{id:"4-deploying-the-database-"},"4. Deploying the Database ",(0,o.kt)(h,{mdxType:"Database"})),(0,o.kt)("p",null,"Any PostgreSQL database will do, as long as you provide the server with the correct ",(0,o.kt)("inlineCode",{parentName:"p"},"DATABASE_URL")," env var and ensure that the database is accessible from the server."),(0,o.kt)("h2",{id:"different-providers"},"Different Providers"),(0,o.kt)("p",null,"We'll cover a few different deployment providers below:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Fly.io ",(0,o.kt)(c,{mdxType:"Server"})," ",(0,o.kt)(h,{mdxType:"Database"})),(0,o.kt)("li",{parentName:"ul"},"Railway ",(0,o.kt)(c,{mdxType:"Server"})," ",(0,o.kt)(k,{mdxType:"Client"})," ",(0,o.kt)(h,{mdxType:"Database"})),(0,o.kt)("li",{parentName:"ul"},"Heroku ",(0,o.kt)(c,{mdxType:"Server"})," ",(0,o.kt)(h,{mdxType:"Database"})),(0,o.kt)("li",{parentName:"ul"},"Netlify ",(0,o.kt)(k,{mdxType:"Client"})),(0,o.kt)("li",{parentName:"ul"},"Cloudflare ",(0,o.kt)(k,{mdxType:"Client"}))),(0,o.kt)("h2",{id:"flyio"},"Fly.io ",(0,o.kt)(c,{mdxType:"Server"})," ",(0,o.kt)(h,{mdxType:"Database"})),(0,o.kt)("p",null,"We will show how to deploy the server and provision a database for it on Fly.io."),(0,o.kt)("admonition",{title:"We automated this process for you",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"If you want to do all of the work below with one command, you can use the ",(0,o.kt)("a",{parentName:"p",href:"/docs/deployment/deployment-methods/cli#flyio"},"Wasp CLI"),"."),(0,o.kt)("p",{parentName:"admonition"},"Wasp CLI deploys the server, deploys the client, and sets up a database.\nIt also gives you a way to redeploy (update) your app with a single command.")),(0,o.kt)("p",null,"Fly.io offers a variety of free services that are perfect for deploying your first Wasp app! You will need a Fly.io account and the ",(0,o.kt)("a",{parentName:"p",href:"https://fly.io/docs/hands-on/install-flyctl/"},(0,o.kt)("inlineCode",{parentName:"a"},"flyctl")," CLI"),"."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Fly.io offers support for both locally built Docker containers and remotely built ones. However, for simplicity and reproducibility, we will default to the use of a remote Fly.io builder."),(0,o.kt)("p",{parentName:"admonition"},"Additionally, ",(0,o.kt)("inlineCode",{parentName:"p"},"fly")," is a symlink for ",(0,o.kt)("inlineCode",{parentName:"p"},"flyctl")," on most systems and they can be used interchangeably.")),(0,o.kt)("p",null,"Make sure you are logged in with ",(0,o.kt)("inlineCode",{parentName:"p"},"flyctl")," CLI. You can check if you are logged in with ",(0,o.kt)("inlineCode",{parentName:"p"},"flyctl auth whoami"),", and if you are not, you can log in with ",(0,o.kt)("inlineCode",{parentName:"p"},"flyctl auth login"),"."),(0,o.kt)("h3",{id:"set-up-a-flyio-app"},"Set Up a Fly.io App"),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"You need to do this only once per Wasp app.")),(0,o.kt)("p",null,"Unless you already have a Fly.io app that you want to deploy to, let's create a new Fly.io app."),(0,o.kt)("p",null,"After you have ",(0,o.kt)("a",{parentName:"p",href:"#1-generating-deployable-code"},"built the app"),", position yourself in ",(0,o.kt)("inlineCode",{parentName:"p"},".wasp/build/")," directory:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"cd .wasp/build\n")),(0,o.kt)("p",null,"Next, run the launch command to set up a new app and create a ",(0,o.kt)("inlineCode",{parentName:"p"},"fly.toml")," file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"flyctl launch --remote-only\n")),(0,o.kt)("p",null,"This will ask you a series of questions, such as asking you to choose a region and whether you'd like a database."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Say ",(0,o.kt)("strong",{parentName:"p"},"yes")," to ",(0,o.kt)("strong",{parentName:"p"},"Would you like to set up a PostgreSQL database now?")," and select ",(0,o.kt)("strong",{parentName:"p"},"Development"),". Fly.io will set a ",(0,o.kt)("inlineCode",{parentName:"p"},"DATABASE_URL")," for you.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Say ",(0,o.kt)("strong",{parentName:"p"},"no")," to ",(0,o.kt)("strong",{parentName:"p"},"Would you like to deploy now?")," (and to any additional questions)."),(0,o.kt)("p",{parentName:"li"},"We still need to set up several environment variables."))),(0,o.kt)("admonition",{title:"What if the database setup fails?",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"If your attempts to initiate a new app fail for whatever reason, then you should run ",(0,o.kt)("inlineCode",{parentName:"p"},"flyctl apps destroy <app-name>")," before trying again. Fly does not allow you to create multiple apps with the same name."),(0,o.kt)("details",null,(0,o.kt)("summary",null,"What does it look like when your DB is deployed correctly?"),(0,o.kt)("div",null,(0,o.kt)("p",null,"When your DB is deployed correctly, you'll see it in the ",(0,o.kt)("a",{href:"https://fly.io/dashboard"},"Fly.io dashboard"),":"),(0,o.kt)("img",{width:"662",alt:"image",src:"/img/deploying/fly-db.png"})))),(0,o.kt)("p",null,"Next, let's copy the ",(0,o.kt)("inlineCode",{parentName:"p"},"fly.toml")," file up to our Wasp project dir for safekeeping."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"cp fly.toml ../../\n")),(0,o.kt)("p",null,"Next, add a few more environment variables for the server code."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"flyctl secrets set PORT=8080\nflyctl secrets set JWT_SECRET=<random_string_at_least_32_characters_long>\nflyctl secrets set WASP_WEB_CLIENT_URL=<url_of_where_client_will_be_deployed>\nflyctl secrets set WASP_SERVER_URL=<url_of_where_server_will_be_deployed>\n")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"If you do not know what your client URL is yet, don't worry. You can set ",(0,o.kt)("inlineCode",{parentName:"p"},"WASP_WEB_CLIENT_URL")," after you deploy your client.")),(0,o.kt)(p,{mdxType:"AddExternalAuthEnvVarsReminder"}),(0,o.kt)("p",null,"If you want to make sure you've added your secrets correctly, run ",(0,o.kt)("inlineCode",{parentName:"p"},"flyctl secrets list")," in the terminal. Note that you will see hashed versions of your secrets to protect your sensitive data."),(0,o.kt)("h3",{id:"deploy-to-a-flyio-app"},"Deploy to a Fly.io App"),(0,o.kt)("p",null,"While still in the ",(0,o.kt)("inlineCode",{parentName:"p"},".wasp/build/")," directory, run:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"flyctl deploy --remote-only --config ../../fly.toml\n")),(0,o.kt)("p",null,"This will build and deploy the backend of your Wasp app on Fly.io to ",(0,o.kt)("inlineCode",{parentName:"p"},"https://<app-name>.fly.dev")," \ud83e\udd18\ud83c\udfb8"),(0,o.kt)("p",null,"Now, if you haven't, you can deploy your client and add the client URL by running ",(0,o.kt)("inlineCode",{parentName:"p"},"flyctl secrets set WASP_WEB_CLIENT_URL=<url_of_deployed_client>"),". We suggest using ",(0,o.kt)("a",{parentName:"p",href:"#netlify"},"Netlify")," for your client, but you can use any static hosting provider."),(0,o.kt)("p",null,"Additionally, some useful ",(0,o.kt)("inlineCode",{parentName:"p"},"flyctl")," commands:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"flyctl logs\nflyctl secrets list\nflyctl ssh console\n")),(0,o.kt)("h3",{id:"redeploying-after-wasp-builds"},"Redeploying After Wasp Builds"),(0,o.kt)("p",null,"When you rebuild your Wasp app (with ",(0,o.kt)("inlineCode",{parentName:"p"},"wasp build"),"), it will remove your ",(0,o.kt)("inlineCode",{parentName:"p"},".wasp/build/")," directory. In there, you may have a ",(0,o.kt)("inlineCode",{parentName:"p"},"fly.toml")," from any prior Fly.io deployments."),(0,o.kt)("p",null,"While we will improve this process in the future, in the meantime, you have a few options:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Copy the ",(0,o.kt)("inlineCode",{parentName:"li"},"fly.toml")," file to a versioned directory, like your Wasp project dir.")),(0,o.kt)("p",null,"From there, you can reference it in ",(0,o.kt)("inlineCode",{parentName:"p"},"flyctl deploy --config <path>")," commands, like above."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Backup the ",(0,o.kt)("inlineCode",{parentName:"li"},"fly.toml")," file somewhere before running ",(0,o.kt)("inlineCode",{parentName:"li"},"wasp build"),", and copy it into .wasp/build/ after.")),(0,o.kt)("p",null,"When the ",(0,o.kt)("inlineCode",{parentName:"p"},"fly.toml")," file exists in .wasp/build/ dir, you do not need to specify the ",(0,o.kt)("inlineCode",{parentName:"p"},"--config <path>"),"."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Run ",(0,o.kt)("inlineCode",{parentName:"li"},"flyctl config save -a <app-name>")," to regenerate the ",(0,o.kt)("inlineCode",{parentName:"li"},"fly.toml")," file from the remote state stored in Fly.io.")),(0,o.kt)("h2",{id:"railway"},"Railway ",(0,o.kt)(c,{mdxType:"Server"})," ",(0,o.kt)(k,{mdxType:"Client"})," ",(0,o.kt)(h,{mdxType:"Database"})),(0,o.kt)("p",null,"We will show how to deploy the client, the server, and provision a database on Railway."),(0,o.kt)("p",null,"Railway is a simple and great way to host your server and database. It's also possible to deploy your entire app: database, server, and client. You can use the platform for free for a limited time, or if you meet certain eligibility requirements. See their ",(0,o.kt)("a",{parentName:"p",href:"https://docs.railway.app/reference/pricing/plans"},"plans page")," for more info."),(0,o.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("p",null,"To get started, follow these steps:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Make sure your Wasp app is built by running ",(0,o.kt)("inlineCode",{parentName:"li"},"wasp build")," in the project dir."),(0,o.kt)("li",{parentName:"ol"},"Create a ",(0,o.kt)("a",{parentName:"li",href:"https://railway.app/"},"Railway")," account")),(0,o.kt)("admonition",{title:"Free Tier",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Sign up with your GitHub account to be eligible for the free tier")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"Install the ",(0,o.kt)("a",{parentName:"li",href:"https://docs.railway.app/develop/cli#installation"},"Railway CLI")),(0,o.kt)("li",{parentName:"ol"},"Run ",(0,o.kt)("inlineCode",{parentName:"li"},"railway login")," and a browser tab will open to authenticate you.")),(0,o.kt)("h3",{id:"create-new-project"},"Create New Project"),(0,o.kt)("p",null,"Let's create our Railway project:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Go to your ",(0,o.kt)("a",{parentName:"li",href:"https://railway.app/dashboard"},"Railway dashboard"),", click on ",(0,o.kt)("strong",{parentName:"li"},"New Project"),", and select ",(0,o.kt)("inlineCode",{parentName:"li"},"Provision PostgreSQL")," from the dropdown menu."),(0,o.kt)("li",{parentName:"ol"},"Once it initializes, right-click on the ",(0,o.kt)("strong",{parentName:"li"},"New")," button in the top right corner and select ",(0,o.kt)("strong",{parentName:"li"},"Empty Service"),"."),(0,o.kt)("li",{parentName:"ol"},"Once it initializes, click on it, go to ",(0,o.kt)("strong",{parentName:"li"},"Settings > General")," and change the name to ",(0,o.kt)("inlineCode",{parentName:"li"},"server")),(0,o.kt)("li",{parentName:"ol"},"Go ahead and create another empty service and name it ",(0,o.kt)("inlineCode",{parentName:"li"},"client"))),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Changing the name",src:n(67323).Z,width:"2444",height:"1556"})),(0,o.kt)("h3",{id:"deploy-your-app-to-railway"},"Deploy Your App to Railway"),(0,o.kt)("h4",{id:"setup-domains"},"Setup Domains"),(0,o.kt)("p",null,"We'll need the domains for both the ",(0,o.kt)("inlineCode",{parentName:"p"},"server")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"client")," services:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Go to the ",(0,o.kt)("inlineCode",{parentName:"li"},"server")," instance's ",(0,o.kt)("inlineCode",{parentName:"li"},"Settings")," tab, and click ",(0,o.kt)("inlineCode",{parentName:"li"},"Generate Domain"),"."),(0,o.kt)("li",{parentName:"ol"},"Do the same under the ",(0,o.kt)("inlineCode",{parentName:"li"},"client"),"'s ",(0,o.kt)("inlineCode",{parentName:"li"},"Settings"),".")),(0,o.kt)("p",null,"Copy the domains as we will need them later."),(0,o.kt)("h4",{id:"deploying-the-server"},"Deploying the Server"),(0,o.kt)("p",null,"Let's deploy our server first:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Move into your app's ",(0,o.kt)("inlineCode",{parentName:"li"},".wasp/build/")," directory:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"cd .wasp/build\n")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Link your app build to your newly created Railway project:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"railway link\n")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Go into the Railway dashboard and set up the required env variables:"),(0,o.kt)("p",{parentName:"li"},"Open the ",(0,o.kt)("inlineCode",{parentName:"p"},"Settings")," and go to the ",(0,o.kt)("inlineCode",{parentName:"p"},"Variables")," tab:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"click ",(0,o.kt)("strong",{parentName:"p"},"Variable reference")," and select ",(0,o.kt)("inlineCode",{parentName:"p"},"DATABASE_URL")," (it will populate it with the correct value)")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"add ",(0,o.kt)("inlineCode",{parentName:"p"},"WASP_WEB_CLIENT_URL")," - enter the ",(0,o.kt)("inlineCode",{parentName:"p"},"client")," domain (e.g. ",(0,o.kt)("inlineCode",{parentName:"p"},"https://client-production-XXXX.up.railway.app"),"). ",(0,o.kt)("inlineCode",{parentName:"p"},"https://")," prefix is required!")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"add ",(0,o.kt)("inlineCode",{parentName:"p"},"WASP_SERVER_URL")," - enter the ",(0,o.kt)("inlineCode",{parentName:"p"},"server")," domain (e.g. ",(0,o.kt)("inlineCode",{parentName:"p"},"https://server-production-XXXX.up.railway.app"),"). ",(0,o.kt)("inlineCode",{parentName:"p"},"https://")," prefix is required!")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"add ",(0,o.kt)("inlineCode",{parentName:"p"},"JWT_SECRET")," - enter a random string at least 32 characters long (use an ",(0,o.kt)("a",{parentName:"p",href:"https://djecrety.ir/"},"online generator"),")"),(0,o.kt)(p,{mdxType:"AddExternalAuthEnvVarsReminder"})))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Push and deploy the project:"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"railway up\n")),(0,o.kt)("p",null,"Select ",(0,o.kt)("inlineCode",{parentName:"p"},"server")," when prompted with ",(0,o.kt)("inlineCode",{parentName:"p"},"Select Service"),"."),(0,o.kt)("p",null,"Railway will now locate the Dockerfile and deploy your server \ud83d\udc4d"),(0,o.kt)("h4",{id:"deploying-the-client"},"Deploying the Client"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Next, change into your app's frontend build directory ",(0,o.kt)("inlineCode",{parentName:"li"},".wasp/build/web-app"),":")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"cd web-app\n")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Create the production build, using the ",(0,o.kt)("inlineCode",{parentName:"li"},"server")," domain as the ",(0,o.kt)("inlineCode",{parentName:"li"},"REACT_APP_API_URL"),":")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"npm install && REACT_APP_API_URL=<url_to_wasp_backend> npm run build\n")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"Next, we want to link this specific frontend directory to our project as well:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"railway link\n")),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"We need to configure Railway's static hosting for our client."),(0,o.kt)("admonition",{parentName:"li",title:"Setting Up Static Hosting",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Copy the ",(0,o.kt)("inlineCode",{parentName:"p"},"build")," folder within the ",(0,o.kt)("inlineCode",{parentName:"p"},"web-app")," directory to ",(0,o.kt)("inlineCode",{parentName:"p"},"dist"),":"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"cp -r build dist\n")),(0,o.kt)("p",{parentName:"admonition"},"We'll need to create the following files:"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"Dockerfile")," with:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-Dockerfile",metastring:'title="Dockerfile"',title:'"Dockerfile"'},'FROM pierrezemb/gostatic\nCMD [ "-fallback", "index.html" ]\nCOPY ./dist/ /srv/http/\n'))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},".dockerignore")," with:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=".dockerignore"',title:'".dockerignore"'},"node_modules/\n")))),(0,o.kt)("p",{parentName:"admonition"},"You'll need to repeat these steps ",(0,o.kt)("strong",{parentName:"p"},"each time")," you run ",(0,o.kt)("inlineCode",{parentName:"p"},"wasp build")," as it will remove the ",(0,o.kt)("inlineCode",{parentName:"p"},".wasp/build/web-app")," directory."),(0,o.kt)("details",null,(0,o.kt)("summary",null,"Here's a useful shell script to do the process"),(0,o.kt)("p",{parentName:"admonition"},"If you want to automate the process, save the following as ",(0,o.kt)("inlineCode",{parentName:"p"},"deploy_client.sh")," in the root of your project:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="deploy_client.sh"',title:'"deploy_client.sh"'},'#!/usr/bin/env bash\n\nif [ -z "$REACT_APP_API_URL" ]\nthen\n  echo "REACT_APP_API_URL is not set"\n  exit 1\nfi\n\nwasp build\ncd .wasp/build/web-app\n\nnpm install && REACT_APP_API_URL=$REACT_APP_API_URL npm run build\n\ncp -r build dist\n\ndockerfile_contents=$(cat <<EOF\nFROM pierrezemb/gostatic\nCMD [ "-fallback", "index.html" ]\nCOPY ./dist/ /srv/http/\nEOF\n)\n\ndockerignore_contents=$(cat <<EOF\nnode_modules/\nEOF\n)\n\necho "$dockerfile_contents" > Dockerfile\necho "$dockerignore_contents" > .dockerignore\n\nrailway up\n')),(0,o.kt)("p",{parentName:"admonition"},"Make it executable with:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"chmod +x deploy_client.sh\n")),(0,o.kt)("p",{parentName:"admonition"},"You can run it with:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"REACT_APP_API_URL=<url_to_wasp_backend> ./deploy_client.sh\n"))))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Set the ",(0,o.kt)("inlineCode",{parentName:"p"},"PORT")," environment variable to ",(0,o.kt)("inlineCode",{parentName:"p"},"8043")," under the ",(0,o.kt)("inlineCode",{parentName:"p"},"Variables")," tab.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Once set, deploy the client and select ",(0,o.kt)("inlineCode",{parentName:"p"},"client")," when prompted with ",(0,o.kt)("inlineCode",{parentName:"p"},"Select Service"),":"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"railway up\n")),(0,o.kt)("h4",{id:"conclusion"},"Conclusion"),(0,o.kt)("p",null,"And now your Wasp should be deployed! \ud83d\udc1d \ud83d\ude82 \ud83d\ude80"),(0,o.kt)("p",null,"Back in your ",(0,o.kt)("a",{parentName:"p",href:"https://railway.app/dashboard"},"Railway dashboard"),", click on your project and you should see your newly deployed services: PostgreSQL, Server, and Client."),(0,o.kt)("h3",{id:"updates--redeploying"},"Updates & Redeploying"),(0,o.kt)("p",null,"When you make updates and need to redeploy:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"run ",(0,o.kt)("inlineCode",{parentName:"li"},"wasp build")," to rebuild your app"),(0,o.kt)("li",{parentName:"ul"},"run ",(0,o.kt)("inlineCode",{parentName:"li"},"railway up")," in the ",(0,o.kt)("inlineCode",{parentName:"li"},".wasp/build")," directory (server)"),(0,o.kt)("li",{parentName:"ul"},"repeat all the steps in the ",(0,o.kt)("inlineCode",{parentName:"li"},".wasp/build/web-app")," directory (client)")),(0,o.kt)("h2",{id:"heroku"},"Heroku ",(0,o.kt)(c,{mdxType:"Server"})," ",(0,o.kt)(h,{mdxType:"Database"})),(0,o.kt)("p",null,"We will show how to deploy the server and provision a database for it on Heroku. You can check their ",(0,o.kt)("a",{parentName:"p",href:"https://www.heroku.com/pricing"},"pricing page")," for more information on their plans."),(0,o.kt)("p",null,"You will need Heroku account, ",(0,o.kt)("inlineCode",{parentName:"p"},"heroku")," ",(0,o.kt)("a",{parentName:"p",href:"https://devcenter.heroku.com/articles/heroku-cli"},"CLI")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"docker")," CLI installed to follow these instructions."),(0,o.kt)("p",null,"Make sure you are logged in with ",(0,o.kt)("inlineCode",{parentName:"p"},"heroku")," CLI. You can check if you are logged in with ",(0,o.kt)("inlineCode",{parentName:"p"},"heroku whoami"),", and if you are not, you can log in with ",(0,o.kt)("inlineCode",{parentName:"p"},"heroku login"),"."),(0,o.kt)("h3",{id:"set-up-a-heroku-app"},"Set up a Heroku app"),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"You need to do this only once per Wasp app.")),(0,o.kt)("p",null,"Unless you want to deploy to an existing Heroku app, let's create a new Heroku app:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"heroku create <app-name>\n")),(0,o.kt)("p",null,"Unless you have an external PostgreSQL database that you want to use, let's create a new database on Heroku and attach it to our app:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"heroku addons:create --app <app-name> heroku-postgresql:essential-0\n")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"We are using the ",(0,o.kt)("inlineCode",{parentName:"p"},"essential-0")," database instance. It's the cheapest database instance Heroku offers and it costs $5/mo.")),(0,o.kt)("p",null,"Heroku will also set ",(0,o.kt)("inlineCode",{parentName:"p"},"DATABASE_URL")," env var for us at this point. If you are using an external database, you will have to set it up yourself."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"PORT")," env var will also be provided by Heroku, so the ones left to set are the ",(0,o.kt)("inlineCode",{parentName:"p"},"JWT_SECRET"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"WASP_WEB_CLIENT_URL")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"WASP_SERVER_URL")," env vars:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"heroku config:set --app <app-name> JWT_SECRET=<random_string_at_least_32_characters_long>\nheroku config:set --app <app-name> WASP_WEB_CLIENT_URL=<url_of_where_client_will_be_deployed>\nheroku config:set --app <app-name> WASP_SERVER_URL=<url_of_where_server_will_be_deployed>\n")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"If you do not know what your client URL is yet, don't worry. You can set ",(0,o.kt)("inlineCode",{parentName:"p"},"WASP_WEB_CLIENT_URL")," after you deploy your client.")),(0,o.kt)("h3",{id:"deploy-the-heroku-app"},"Deploy the Heroku app"),(0,o.kt)("p",null,"After you have ",(0,o.kt)("a",{parentName:"p",href:"#1-generating-deployable-code"},"built the app"),", position yourself in ",(0,o.kt)("inlineCode",{parentName:"p"},".wasp/build/")," directory:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"cd .wasp/build\n")),(0,o.kt)("p",null,"assuming you were at the root of your Wasp project at that moment."),(0,o.kt)("p",null,"Log in to Heroku Container Registry:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"heroku container:login\n")),(0,o.kt)("p",null,"Set your app's stack to ",(0,o.kt)("inlineCode",{parentName:"p"},"container")," so we can deploy our app as a Docker container:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"heroku stack:set container --app <app-name>\n")),(0,o.kt)("p",null,"Build the Docker image and push it to Heroku:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"heroku container:push --app <app-name> web\n")),(0,o.kt)("p",null,"App is still not deployed at this point.\nThis step might take some time, especially the very first time, since there are no cached Docker layers."),(0,o.kt)("p",null,"Deploy the pushed image and restart the app:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"heroku container:release --app <app-name> web\n")),(0,o.kt)("p",null,"This is it, the backend is deployed at ",(0,o.kt)("inlineCode",{parentName:"p"},"https://<app-name>-XXXX.herokuapp.com")," \ud83c\udf89"),(0,o.kt)("p",null,"Find out the exact app URL with:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"heroku info --app <app-name>\n")),(0,o.kt)("p",null,"Additionally, you can check out the logs with:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"heroku logs --tail --app <app-name>\n")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("mdxAdmonitionTitle",{parentName:"admonition"},"Using ",(0,o.kt)("inlineCode",{parentName:"mdxAdmonitionTitle"},"pg-boss")," with Heroku"),(0,o.kt)("p",{parentName:"admonition"},"If you wish to deploy an app leveraging ",(0,o.kt)("a",{parentName:"p",href:"../../advanced/jobs"},"Jobs")," that use ",(0,o.kt)("inlineCode",{parentName:"p"},"pg-boss")," as the executor to Heroku, you need to set an additional environment variable called ",(0,o.kt)("inlineCode",{parentName:"p"},"PG_BOSS_NEW_OPTIONS")," to ",(0,o.kt)("inlineCode",{parentName:"p"},'{"connectionString":"<REGULAR_HEROKU_DATABASE_URL>","ssl":{"rejectUnauthorized":false}}'),". This is because pg-boss uses the ",(0,o.kt)("inlineCode",{parentName:"p"},"pg")," extension, which does not seem to connect to Heroku over SSL by default, which Heroku requires. Additionally, Heroku uses a self-signed cert, so we must handle that as well."),(0,o.kt)("p",{parentName:"admonition"},"Read more: ",(0,o.kt)("a",{parentName:"p",href:"https://devcenter.heroku.com/articles/connecting-heroku-postgres#connecting-in-node-js"},"https://devcenter.heroku.com/articles/connecting-heroku-postgres#connecting-in-node-js"))),(0,o.kt)("h2",{id:"netlify"},"Netlify ",(0,o.kt)(k,{mdxType:"Client"})),(0,o.kt)("p",null,"Netlify is a static hosting solution that is free for many use cases. You will need a Netlify account to follow these instructions."),(0,o.kt)("p",null,"Make sure you are logged in with Netlify CLI. You can check if you are logged in with ",(0,o.kt)("inlineCode",{parentName:"p"},"npx netlify-cli status"),", and if you are not, you can log in with ",(0,o.kt)("inlineCode",{parentName:"p"},"npx netlify-cli login"),"."),(0,o.kt)("p",null,"First, make sure you have ",(0,o.kt)("a",{parentName:"p",href:"#1-generating-deployable-code"},"built the Wasp app"),". We'll build the client web app next."),(0,o.kt)(u,{mdxType:"BuildingTheWebClient"}),(0,o.kt)("p",null,"We can now deploy the client with:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"npx netlify-cli deploy\n")),(0,o.kt)("small",null,(0,o.kt)("p",null,"Carefully follow the instructions: decide if you want to create a new app or use an existing one, pick the team under which your app will be deployed etc.")),(0,o.kt)("p",null,"The final step is to run:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"npx netlify-cli deploy --prod\n")),(0,o.kt)("p",null,"That is it! Your client should be live at ",(0,o.kt)("inlineCode",{parentName:"p"},"https://<app-name>.netlify.app"),"."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Make sure you set the ",(0,o.kt)("inlineCode",{parentName:"p"},"https://<app-name>.netlify.app")," URL as the ",(0,o.kt)("inlineCode",{parentName:"p"},"WASP_WEB_CLIENT_URL")," environment variable in your server hosting environment.")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("mdxAdmonitionTitle",{parentName:"admonition"},"Redirecting URLs toward ",(0,o.kt)("inlineCode",{parentName:"mdxAdmonitionTitle"},"index.html")),(0,o.kt)("p",{parentName:"admonition"},"If you follow the instructions above, the Netlify CLI will use ",(0,o.kt)("inlineCode",{parentName:"p"},"netlify.toml")," file that Wasp generates by default in ",(0,o.kt)("inlineCode",{parentName:"p"},".wasp/build/web-app/"),". This will correctly configure Netlify to redirect URLs toward ",(0,o.kt)("inlineCode",{parentName:"p"},"index.html"),", which is important since Wasp is a Single Page Application (SPA) and needs to handle routing on the client side."),(0,o.kt)("p",{parentName:"admonition"},"If you instead use another method of deployment to Netlify, for example doing it using CI, make sure that Netlify picks up that ",(0,o.kt)("inlineCode",{parentName:"p"},"netlify.toml")," file, or configure URL redirecting yourself manually on Netlify."),(0,o.kt)("p",{parentName:"admonition"},"We recommend to deploy using the Netlify CLI in Github Actions. You can find an example Github Action configuration below.")),(0,o.kt)("h3",{id:"deploying-through-github-actions"},"Deploying through Github Actions"),(0,o.kt)("p",null,"To enable automatic deployment of the client whenever you push to the ",(0,o.kt)("inlineCode",{parentName:"p"},"main")," branch, you can set up a GitHub Actions workflow. To do this, create a file in your repository at ",(0,o.kt)("inlineCode",{parentName:"p"},".github/workflows/deploy.yaml"),". Feel free to rename ",(0,o.kt)("inlineCode",{parentName:"p"},"deploy.yaml")," as long as the file type is not changed."),(0,o.kt)("p",null,"Here\u2019s an example configuration file to help you get started. This example workflow will trigger a deployment to Netlify whenever changes are pushed to the main branch."),(0,o.kt)("details",null,(0,o.kt)("summary",null,"Example Github Action"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"name: Deploy Client to Netlify\n\non:\n  push:\n    branches:\n      - main # Deploy on every push to the main branch\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n\n    steps:\n      - name: Checkout Code\n        uses: actions/checkout@v2\n\n      - name: Setup Node.js\n        id: setup-node\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n\n      - name: Install Wasp\n        run: curl -sSL https://get.wasp-lang.dev/installer.sh | sh -s -- -v 0.15.0 # Change to your Wasp version\n\n      - name: Wasp Build\n        run: wasp build\n\n      - name: Install dependencies and build the client\n        run: |\n          cd ./.wasp/build/web-app\n          npm install\n          REACT_APP_API_URL=${{ secrets.WASP_SERVER_URL }} npm run build\n\n      - name: Deploy to Netlify\n        run: |\n          cd ./.wasp/build/web-app\n          npx netlify-cli@17.36.1 deploy --prod --dir=build --auth=$NETLIFY_AUTH_TOKEN --site=$NETLIFY_SITE_NAME\n\n    env:\n      NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}\n      NETLIFY_SITE_NAME: netlify-site-name\n"))),(0,o.kt)("details",null,(0,o.kt)("summary",null,"How do I get the Environment Variables?"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"NETLIFY_AUTH_TOKEN")),": For the auth token, you'll generate a new Personal Access Token on ",(0,o.kt)("a",{parentName:"p",href:"https://docs.netlify.com/cli/get-started/#obtain-a-token-in-the-netlify-ui"},"Netlify"),".")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"NETLIFY_SITE_NAME")),": This is the name of your Netlify project.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"WASP_SERVER_URL")),": This is your server's URL and is generally only available after ",(0,o.kt)("strong",{parentName:"p"},"deploying the backend"),". This variable can be skipped when the backend is not functional or not deployed, but be aware that backend-dependent functionalities may be broken."))),(0,o.kt)("p",null,"After getting the environment variables, you need to set these in GitHub Repository Secrets.")),(0,o.kt)("h2",{id:"cloudflare"},"Cloudflare ",(0,o.kt)(k,{mdxType:"Client"})),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.cloudflare.com/"},"Cloudflare")," is a cloud services provider that offers a variety of services, including free static hosting with Cloudflare Pages. You will need a Cloudflare account to follow these instructions."),(0,o.kt)("p",null,"Make sure you are logged in with the Cloudflare's CLI called Wrangler. You can log in by running:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"npx wrangler login\n")),(0,o.kt)("p",null,"Before you continue, make sure you have ",(0,o.kt)("a",{parentName:"p",href:"#1-generating-deployable-code"},"built the Wasp app"),". We'll build the client web app next."),(0,o.kt)(u,{mdxType:"BuildingTheWebClient"}),(0,o.kt)("p",null,"To deploy the client, make sure you are positioned in the ",(0,o.kt)("inlineCode",{parentName:"p"},".wasp/buld/web-app")," folder and then run the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"npx wrangler pages deploy ./build --commit-dirty=true --branch=main\n")),(0,o.kt)("small",null,(0,o.kt)("p",null,"Carefully follow the instructions i.e. do you want to create a new app or use an existing one.")),(0,o.kt)("p",null,"That is it! Your client should be live at ",(0,o.kt)("inlineCode",{parentName:"p"},"https://<app-name>.pages.dev"),"."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Make sure you set the ",(0,o.kt)("inlineCode",{parentName:"p"},"https://<app-name>.pages.dev")," URL as the ",(0,o.kt)("inlineCode",{parentName:"p"},"WASP_WEB_CLIENT_URL")," environment variable in your server hosting environment.")),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("mdxAdmonitionTitle",{parentName:"admonition"},"Redirecting URLs toward ",(0,o.kt)("inlineCode",{parentName:"mdxAdmonitionTitle"},"index.html")),(0,o.kt)("p",{parentName:"admonition"},"Cloudflare will automatically redirect all paths toward ",(0,o.kt)("inlineCode",{parentName:"p"},"index.html"),", which is important since Wasp's client app is a Single Page Application (SPA) and needs to handle routing on the client side.")),(0,o.kt)("h3",{id:"deploying-through-github-actions-1"},"Deploying through Github Actions"),(0,o.kt)("p",null,"To enable automatic deployment of the client whenever you push to the ",(0,o.kt)("inlineCode",{parentName:"p"},"main")," branch, you can set up a GitHub Actions workflow. To do this, create a file in your repository at ",(0,o.kt)("inlineCode",{parentName:"p"},".github/workflows/deploy.yaml"),". Feel free to rename ",(0,o.kt)("inlineCode",{parentName:"p"},"deploy.yaml")," as long as the file type is not changed."),(0,o.kt)("p",null,"Here\u2019s an example configuration file to help you get started. This example workflow will trigger a deployment to Cloudflare Pages whenever changes are pushed to the main branch."),(0,o.kt)("details",null,(0,o.kt)("summary",null,"Example Github Action"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"name: Deploy Client to Cloudflare\n\non:\n  push:\n    branches:\n      - main # Deploy on every push to the main branch\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n\n    steps:\n      - name: Checkout Code\n        uses: actions/checkout@v2\n\n      - name: Setup Node.js\n        id: setup-node\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n\n      - name: Install Wasp\n        run: curl -sSL https://get.wasp-lang.dev/installer.sh | sh -s -- -v 0.15.0 # Change to your Wasp version\n\n      - name: Wasp Build\n        run: cd ./app && wasp build\n\n      - name: Install dependencies and build the client\n        run: |\n          cd ./app/.wasp/build/web-app\n          npm install\n          REACT_APP_API_URL=${{ secrets.WASP_SERVER_URL }} npm run build\n\n      - name: Deploy to Cloudflare Pages\n        uses: cloudflare/wrangler-action@v3\n        with:\n          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}\n          accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}\n          command: pages deploy ./app/.wasp/build/web-app/build --project-name=${{ env.CLIENT_CLOUDFLARE_APP_NAME }} --commit-dirty=true --branch=main\n\n    env:\n      CLIENT_CLOUDFLARE_APP_NAME: cloudflare-pages-app-name\n"))),(0,o.kt)("details",null,(0,o.kt)("summary",null,"How do I get the Environment Variables?"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"CLOUDFLARE_API_TOKEN")," and ",(0,o.kt)("inlineCode",{parentName:"strong"},"CLOUDFLARE_ACCOUNT_ID")),": You can get these from your ",(0,o.kt)("a",{parentName:"p",href:"https://dash.cloudflare.com/profile/api-tokens"},"Cloudflare dashboard"),". Make sure to give the token ",(0,o.kt)("inlineCode",{parentName:"p"},"Cloudflare Pages: Read")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Cloudflare Pages: Edit")," permissions.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"CLIENT_CLOUDFLARE_APP_NAME")),": This is the name of your Cloudflare Pages app. You can create a new Cloudflare Pages app with ",(0,o.kt)("inlineCode",{parentName:"p"},"npx wrangler pages project create <app-name>"),".")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"WASP_SERVER_URL")),": This is your server's URL and is generally only available after ",(0,o.kt)("strong",{parentName:"p"},"deploying the backend"),". This variable can be skipped when the backend is not functional or not deployed, but be aware that backend-dependent functionalities may be broken."))),(0,o.kt)("p",null,"After getting the environment variables, you need to set these in GitHub Repository Secrets.")))}C.isMDXComponent=!0},67323:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/railway-rename-78e07d8f6359fdb9eca0dc982357fb89.png"}}]);