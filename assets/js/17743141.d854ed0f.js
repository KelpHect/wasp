"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[68036],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>h});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},d=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),u=p(a),m=r,h=u["".concat(l,".").concat(m)]||u[m]||c[m]||i;return a?n.createElement(h,s(s({ref:t},d),{},{components:a})):n.createElement(h,s({ref:t},d))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,s=new Array(i);s[0]=m;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[u]="string"==typeof e?e:r,s[1]=o;for(var p=2;p<i;p++)s[p]=a[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},85162:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(67294),r=a(86010);const i={tabItem:"tabItem_Ymn6"};function s(e){let{children:t,hidden:a,className:s}=e;return n.createElement("div",{role:"tabpanel",className:(0,r.Z)(i.tabItem,s),hidden:a},t)}},74866:(e,t,a)=>{a.d(t,{Z:()=>w});var n=a(87462),r=a(67294),i=a(86010),s=a(12466),o=a(16550),l=a(91980),p=a(67392),d=a(50012);function u(e){return function(e){return r.Children.map(e,(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:a,attributes:n,default:r}}=e;return{value:t,label:a,attributes:n,default:r}}))}function c(e){const{values:t,children:a}=e;return(0,r.useMemo)((()=>{const e=t??u(a);return function(e){const t=(0,p.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,a])}function m(e){let{value:t,tabValues:a}=e;return a.some((e=>e.value===t))}function h(e){let{queryString:t=!1,groupId:a}=e;const n=(0,o.k6)(),i=function(e){let{queryString:t=!1,groupId:a}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:t,groupId:a});return[(0,l._X)(i),(0,r.useCallback)((e=>{if(!i)return;const t=new URLSearchParams(n.location.search);t.set(i,e),n.replace({...n.location,search:t.toString()})}),[i,n])]}function k(e){const{defaultValue:t,queryString:a=!1,groupId:n}=e,i=c(e),[s,o]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=a.find((e=>e.default))??a[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:i}))),[l,p]=h({queryString:a,groupId:n}),[u,k]=function(e){let{groupId:t}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,i]=(0,d.Nk)(a);return[n,(0,r.useCallback)((e=>{a&&i.set(e)}),[a,i])]}({groupId:n}),f=(()=>{const e=l??u;return m({value:e,tabValues:i})?e:null})();(0,r.useLayoutEffect)((()=>{f&&o(f)}),[f]);return{selectedValue:s,selectValue:(0,r.useCallback)((e=>{if(!m({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);o(e),p(e),k(e)}),[p,k,i]),tabValues:i}}var f=a(72389);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function g(e){let{className:t,block:a,selectedValue:o,selectValue:l,tabValues:p}=e;const d=[],{blockElementScrollPositionUntilNextRender:u}=(0,s.o5)(),c=e=>{const t=e.currentTarget,a=d.indexOf(t),n=p[a].value;n!==o&&(u(t),l(n))},m=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const a=d.indexOf(e.currentTarget)+1;t=d[a]??d[0];break}case"ArrowLeft":{const a=d.indexOf(e.currentTarget)-1;t=d[a]??d[d.length-1];break}}t?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":a},t)},p.map((e=>{let{value:t,label:a,attributes:s}=e;return r.createElement("li",(0,n.Z)({role:"tab",tabIndex:o===t?0:-1,"aria-selected":o===t,key:t,ref:e=>d.push(e),onKeyDown:m,onClick:c},s,{className:(0,i.Z)("tabs__item",b.tabItem,s?.className,{"tabs__item--active":o===t})}),a??t)})))}function v(e){let{lazy:t,children:a,selectedValue:n}=e;const i=(Array.isArray(a)?a:[a]).filter(Boolean);if(t){const e=i.find((e=>e.props.value===n));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},i.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==n}))))}function y(e){const t=k(e);return r.createElement("div",{className:(0,i.Z)("tabs-container",b.tabList)},r.createElement(g,(0,n.Z)({},e,t)),r.createElement(v,(0,n.Z)({},e,t)))}function w(e){const t=(0,f.Z)();return r.createElement(y,(0,n.Z)({key:String(t)},e))}},46300:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(67294),r=a(50012);function i(e){let{path:t}=e;const[a]=(0,r.Nk)("docusaurus.tab.js-ts"),i=t.lastIndexOf("{"),s=t.slice(i+1,t.length-1),[o,l]=s.split(","),p=t.slice(0,i);return n.createElement("code",null,p+("js"===a?o:l))}},87587:(e,t,a)=>{a.d(t,{Fi:()=>o,Jp:()=>i,Vp:()=>r,aH:()=>s});var n=a(67294);const r=e=>{let{color:t,children:a}=e;return n.createElement("span",{style:{border:`2px solid ${t}`,display:"inline-block",padding:"0.2em 0.4em",color:t,borderRadius:"0.4em",fontSize:"0.8em",lineHeight:"1",fontWeight:"bold"}},a)};function i(){return n.createElement(r,{color:"#0b62f5"},"internal")}function s(){return n.createElement(r,{color:"#f59e0b"},"required")}function o(){return n.createElement(r,{color:"#08c47e"},"optional")}},67625:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>p,toc:()=>u});var n=a(87462),r=(a(67294),a(3905)),i=(a(46300),a(85162)),s=a(74866);a(87587);const o={title:"Databases"},l=void 0,p={unversionedId:"data-model/backends",id:"version-0.16.0/data-model/backends",title:"Databases",description:"Entities, Operations and Automatic CRUD together make a high-level interface for working with your app's data. Still, all that data has to live somewhere, so let's see how Wasp deals with databases.",source:"@site/versioned_docs/version-0.16.0/data-model/backends.md",sourceDirName:"data-model",slug:"/data-model/backends",permalink:"/docs/data-model/backends",draft:!1,editUrl:"https://github.com/wasp-lang/wasp/edit/release/web/versioned_docs/version-0.16.0/data-model/backends.md",tags:[],version:"0.16.0",frontMatter:{title:"Databases"},sidebar:"docs",previous:{title:"Automatic CRUD",permalink:"/docs/data-model/crud"},next:{title:"Prisma Schema File",permalink:"/docs/data-model/prisma-file"}},d={},u=[{value:"Supported Database Backends",id:"supported-database-backends",level:2},{value:"SQLite",id:"sqlite",level:3},{value:"PostgreSQL",id:"postgresql",level:3},{value:"Connecting to a Database",id:"connecting-to-a-database",level:2},{value:"SQLite",id:"sqlite-1",level:3},{value:"PostgreSQL",id:"postgresql-1",level:3},{value:"Using the Dev Database provided by Wasp",id:"using-the-dev-database-provided-by-wasp",level:4},{value:"Connecting to an existing database",id:"connecting-to-an-existing-database",level:4},{value:"Migrating from SQLite to PostgreSQL",id:"migrating-from-sqlite-to-postgresql",level:2},{value:"Seeding the Database",id:"seeding-the-database",level:2},{value:"Writing a Seed Function",id:"writing-a-seed-function",level:3},{value:"Running seed functions",id:"running-seed-functions",level:3},{value:"API Reference",id:"api-reference",level:2},{value:"CLI Commands for Seeding the Database",id:"cli-commands-for-seeding-the-database",level:3}],c={toc:u},m="wrapper";function h(e){let{components:t,...a}=e;return(0,r.kt)(m,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/data-model/entities"},"Entities"),", ",(0,r.kt)("a",{parentName:"p",href:"../data-model/operations/overview"},"Operations")," and ",(0,r.kt)("a",{parentName:"p",href:"/docs/data-model/crud"},"Automatic CRUD")," together make a high-level interface for working with your app's data. Still, all that data has to live somewhere, so let's see how Wasp deals with databases."),(0,r.kt)("h2",{id:"supported-database-backends"},"Supported Database Backends"),(0,r.kt)("p",null,"Wasp supports multiple database backends. We'll list and explain each one."),(0,r.kt)("h3",{id:"sqlite"},"SQLite"),(0,r.kt)("p",null,"The default database Wasp uses is ",(0,r.kt)("a",{parentName:"p",href:"https://www.sqlite.org/index.html"},"SQLite"),"."),(0,r.kt)("p",null,"When you create a new Wasp project, the ",(0,r.kt)("inlineCode",{parentName:"p"},"schema.prisma")," file will have SQLite as the default database provider:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-prisma",metastring:'title="schema.prisma"',title:'"schema.prisma"'},'datasource db {\n  provider = "sqlite"\n  url      = env("DATABASE_URL")\n}\n\n// ...\n')),(0,r.kt)("small",null,(0,r.kt)("p",null,"Read more about how Wasp uses the Prisma schema file in the ",(0,r.kt)("a",{parentName:"p",href:"/docs/data-model/prisma-file"},"Prisma schema file")," section.")),(0,r.kt)("p",null,"When you use the SQLite database, Wasp sets the ",(0,r.kt)("inlineCode",{parentName:"p"},"DATABASE_URL")," environment variable for you."),(0,r.kt)("p",null,"SQLite is a great way to get started with a new project because it doesn't require any configuration, but Wasp can only use it in development. Once you want to deploy your Wasp app to production, you'll need to switch to PostgreSQL and stick with it."),(0,r.kt)("p",null,"Fortunately, migrating from SQLite to PostgreSQL is pretty simple, and we have ",(0,r.kt)("a",{parentName:"p",href:"#migrating-from-sqlite-to-postgresql"},"a guide")," to help you."),(0,r.kt)("h3",{id:"postgresql"},"PostgreSQL"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.postgresql.org/"},"PostgreSQL")," is the most advanced open-source database and one of the most popular databases overall.\nIt's been in active development for 20+ years.\nTherefore, if you're looking for a battle-tested database, look no further."),(0,r.kt)("p",null,"To use PostgreSQL with Wasp, set the provider to ",(0,r.kt)("inlineCode",{parentName:"p"},'"postgresql"')," in the ",(0,r.kt)("inlineCode",{parentName:"p"},"schema.prisma")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-prisma",metastring:'title="schema.prisma"',title:'"schema.prisma"'},'datasource db {\n  provider = "postgresql"\n  url      = env("DATABASE_URL")\n}\n\n// ...\n')),(0,r.kt)("small",null,(0,r.kt)("p",null,"Read more about how Wasp uses the Prisma schema file in the ",(0,r.kt)("a",{parentName:"p",href:"/docs/data-model/prisma-file"},"Prisma schema file")," section.")),(0,r.kt)("p",null,"You'll have to ensure a database instance is running during development to use PostgreSQL. Wasp needs access to your database for commands such as ",(0,r.kt)("inlineCode",{parentName:"p"},"wasp start")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"wasp db migrate-dev"),"."),(0,r.kt)("p",null,"We cover all supported ways of connecting to a database in ",(0,r.kt)("a",{parentName:"p",href:"#connecting-to-a-database"},"the next section"),"."),(0,r.kt)("h2",{id:"connecting-to-a-database"},"Connecting to a Database"),(0,r.kt)("h3",{id:"sqlite-1"},"SQLite"),(0,r.kt)("p",null,"If you are using SQLite, you don't need to do anything special to connect to the database. Wasp will take care of it for you."),(0,r.kt)("h3",{id:"postgresql-1"},"PostgreSQL"),(0,r.kt)("p",null,"If you are using PostgreSQL, Wasp supports two ways of connecting to a database:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"For managed experience, let Wasp spin up a ready-to-go development database for you."),(0,r.kt)("li",{parentName:"ol"},"For more control, you can specify a database URL and connect to an existing database that you provisioned yourself.")),(0,r.kt)("h4",{id:"using-the-dev-database-provided-by-wasp"},"Using the Dev Database provided by Wasp"),(0,r.kt)("p",null,"The command ",(0,r.kt)("inlineCode",{parentName:"p"},"wasp start db")," will start a default PostgreSQL dev database for you."),(0,r.kt)("p",null,"Your Wasp app will automatically connect to it, just keep ",(0,r.kt)("inlineCode",{parentName:"p"},"wasp start db")," running in the background.\nAlso, make sure that:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"You have ",(0,r.kt)("a",{parentName:"li",href:"https://www.docker.com/get-started/"},"Docker installed")," and it's available in your ",(0,r.kt)("inlineCode",{parentName:"li"},"PATH"),"."),(0,r.kt)("li",{parentName:"ul"},"The port ",(0,r.kt)("inlineCode",{parentName:"li"},"5432")," isn't taken.")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"In case you might want to connect to the dev database through the external tool like ",(0,r.kt)("inlineCode",{parentName:"p"},"psql")," or ",(0,r.kt)("a",{parentName:"p",href:"https://www.pgadmin.org/"},"pgAdmin"),", the credentials are printed in the console when you run ",(0,r.kt)("inlineCode",{parentName:"p"},"wasp db start"),", at the very beginning.")),(0,r.kt)("h4",{id:"connecting-to-an-existing-database"},"Connecting to an existing database"),(0,r.kt)("p",null,"If you want to spin up your own dev database (or connect to an external one), you can tell Wasp about it using the ",(0,r.kt)("inlineCode",{parentName:"p"},"DATABASE_URL")," environment variable. Wasp will use the value of ",(0,r.kt)("inlineCode",{parentName:"p"},"DATABASE_URL")," as a connection string."),(0,r.kt)("p",null,"The easiest way to set the necessary ",(0,r.kt)("inlineCode",{parentName:"p"},"DATABASE_URL")," environment variable is by adding it to the ",(0,r.kt)("a",{parentName:"p",href:"../project/env-vars"},".env.server")," file in the root dir of your Wasp project (if that file doesn't yet exist, create it):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-env",metastring:'title=".env.server"',title:'".env.server"'},"DATABASE_URL=postgresql://user:password@localhost:5432/mydb\n")),(0,r.kt)("p",null,"Alternatively, you can set it inline when running ",(0,r.kt)("inlineCode",{parentName:"p"},"wasp")," (this applies to all environment variables):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"DATABASE_URL=<my-db-url> wasp ...\n")),(0,r.kt)("p",null,"This trick is useful for running a certain ",(0,r.kt)("inlineCode",{parentName:"p"},"wasp")," command on a specific database.\nFor example, you could do:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"DATABASE_URL=<production-db-url> wasp db seed myProductionSeed\n")),(0,r.kt)("p",null,"This command seeds the data for a fresh staging or production database. Read more about ",(0,r.kt)("a",{parentName:"p",href:"#seeding-the-database"},"seeding the database"),"."),(0,r.kt)("h2",{id:"migrating-from-sqlite-to-postgresql"},"Migrating from SQLite to PostgreSQL"),(0,r.kt)("p",null,"To run your Wasp app in production, you'll need to switch from SQLite to PostgreSQL."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Set the provider to ",(0,r.kt)("inlineCode",{parentName:"p"},'"postgresql"')," in the ",(0,r.kt)("inlineCode",{parentName:"p"},"schema.prisma")," file:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-prisma",metastring:'title="schema.prisma"',title:'"schema.prisma"'},'datasource db {\n  // highlight-next-line\n  provider = "postgresql"\n  url      = env("DATABASE_URL")\n}\n\n// ...\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Delete all the old migrations, since they are SQLite migrations and can't be used with PostgreSQL, as well as the SQLite database by running ",(0,r.kt)("a",{parentName:"p",href:"https://wasp-lang.dev/docs/general/cli#project-commands"},(0,r.kt)("inlineCode",{parentName:"a"},"wasp clean")),":"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"rm -r migrations/\nwasp clean\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Ensure your new database is running (check the ",(0,r.kt)("a",{parentName:"p",href:"#connecting-to-a-database"},"section on connecting to a database")," to see how). Leave it running, since we need it for the next step.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In a different terminal, run ",(0,r.kt)("inlineCode",{parentName:"p"},"wasp db migrate-dev")," to apply the changes and create a new initial migration.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"That is it, you are all done!"))),(0,r.kt)("h2",{id:"seeding-the-database"},"Seeding the Database"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Database seeding")," is a term used for populating the database with some initial data."),(0,r.kt)("p",null,"Seeding is most commonly used for:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Getting the development database into a state convenient for working and testing."),(0,r.kt)("li",{parentName:"ol"},"Initializing any database (",(0,r.kt)("inlineCode",{parentName:"li"},"dev"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"staging"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"prod"),") with essential data it requires to operate.\nFor example, populating the Currency table with default currencies, or the Country table with all available countries.")),(0,r.kt)("h3",{id:"writing-a-seed-function"},"Writing a Seed Function"),(0,r.kt)("p",null,"You can define as many ",(0,r.kt)("strong",{parentName:"p"},"seed functions")," as you want in an array under the ",(0,r.kt)("inlineCode",{parentName:"p"},"app.db.seeds")," field:"),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:"title=main.wasp",title:"main.wasp"},'app MyApp {\n  // ...\n  db: {\n    seeds: [\n      import { devSeedSimple } from "@src/dbSeeds.js",\n      import { prodSeed } from "@src/dbSeeds.js"\n    ]\n  }\n}\n'))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:"title=main.wasp",title:"main.wasp"},'app MyApp {\n  // ...\n  db: {\n    seeds: [\n      import { devSeedSimple } from "@src/dbSeeds.js",\n      import { prodSeed } from "@src/dbSeeds.js"\n    ]\n  }\n}\n')))),(0,r.kt)("p",null,"Each seed function must be an async function that takes one argument, ",(0,r.kt)("inlineCode",{parentName:"p"},"prisma"),", which is a ",(0,r.kt)("a",{parentName:"p",href:"https://www.prisma.io/docs/concepts/components/prisma-client/crud"},"Prisma Client")," instance used to interact with the database.\nThis is the same Prisma Client instance that Wasp uses internally."),(0,r.kt)("p",null,"Since a seed function falls under server-side code, it can import other server-side functions. This is convenient because you might want to seed the database using Actions."),(0,r.kt)("p",null,"Here's an example of a seed function that imports an Action:"),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { createTask } from './actions.js'\nimport { sanitizeAndSerializeProviderData } from 'wasp/server/auth'\n\nexport const devSeedSimple = async (prisma) => {\n  const user = await createUser(prisma, {\n    username: 'RiuTheDog',\n    password: 'bark1234',\n  })\n\n  await createTask(\n    { description: 'Chase the cat' },\n    { user, entities: { Task: prisma.task } }\n  )\n}\n\nasync function createUser(prisma, data) {\n  const newUser = await prisma.user.create({\n    data: {\n      auth: {\n        create: {\n          identities: {\n            create: {\n              providerName: 'username',\n              providerUserId: data.username,\n              providerData: sanitizeAndSerializeProviderData({\n                hashedPassword: data.password\n              }),\n            },\n          },\n        },\n      },\n    },\n  })\n\n  return newUser\n}\n"))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { createTask } from './actions.js'\nimport { type DbSeedFn } from 'wasp/server'\nimport { sanitizeAndSerializeProviderData } from 'wasp/server/auth'\nimport { type AuthUser } from 'wasp/auth'\nimport { PrismaClient } from '@prisma/client'\n\nexport const devSeedSimple: DbSeedFn = async (prisma) => {\n  const user = await createUser(prisma, {\n    username: 'RiuTheDog',\n    password: 'bark1234',\n  })\n\n  await createTask(\n    { description: 'Chase the cat', isDone: false },\n    { user, entities: { Task: prisma.task } }\n  )\n};\n\nasync function createUser(\n  prisma: PrismaClient,\n  data: { username: string, password: string }\n): Promise<AuthUser> {\n  const newUser = await prisma.user.create({\n    data: {\n      auth: {\n        create: {\n          identities: {\n            create: {\n              providerName: 'username',\n              providerUserId: data.username,\n              providerData: sanitizeAndSerializeProviderData<'username'>({\n                hashedPassword: data.password\n              }),\n            },\n          },\n        },\n      },\n    },\n  })\n\n  return newUser\n}\n")),(0,r.kt)("p",null,"Wasp exports a type called ",(0,r.kt)("inlineCode",{parentName:"p"},"DbSeedFn")," which you can use to easily type your seeding function.\nWasp defines ",(0,r.kt)("inlineCode",{parentName:"p"},"DbSeedFn")," like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"type DbSeedFn = (prisma: PrismaClient) => Promise<void>\n")),(0,r.kt)("p",null,"Annotating the function ",(0,r.kt)("inlineCode",{parentName:"p"},"devSeedSimple")," with this type tells TypeScript:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The seeding function's argument (",(0,r.kt)("inlineCode",{parentName:"li"},"prisma"),") is of type ",(0,r.kt)("inlineCode",{parentName:"li"},"PrismaClient"),"."),(0,r.kt)("li",{parentName:"ul"},"The seeding function's return value is ",(0,r.kt)("inlineCode",{parentName:"li"},"Promise<void>"),".")))),(0,r.kt)("h3",{id:"running-seed-functions"},"Running seed functions"),(0,r.kt)("p",null,"Run the command ",(0,r.kt)("inlineCode",{parentName:"p"},"wasp db seed")," and Wasp will ask you which seed function you'd like to run (if you've defined more than one)."),(0,r.kt)("p",null,"Alternatively, run the command ",(0,r.kt)("inlineCode",{parentName:"p"},"wasp db seed <seed-name>")," to choose a specific seed function right away, for example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"wasp db seed devSeedSimple\n")),(0,r.kt)("p",null,"Check the ",(0,r.kt)("a",{parentName:"p",href:"#cli-commands-for-seeding-the-database"},"API Reference")," for more details on these commands."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"You'll often want to call ",(0,r.kt)("inlineCode",{parentName:"p"},"wasp db seed")," right after you run ",(0,r.kt)("inlineCode",{parentName:"p"},"wasp db reset"),", as it makes sense to fill the database with initial data after clearing it.")),(0,r.kt)("h2",{id:"api-reference"},"API Reference"),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:"title=main.wasp",title:"main.wasp"},'app MyApp {\n  title: "My app",\n  // ...\n  db: {\n    seeds: [\n      import devSeed from "@src/dbSeeds.js"\n    ],\n  }\n}\n'))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:"title=main.wasp",title:"main.wasp"},'app MyApp {\n  title: "My app",\n  // ...\n  db: {\n    seeds: [\n      import devSeed from "@src/dbSeeds.js"\n    ],\n  }\n}\n')))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"app.db")," is a dictionary with the following fields (all fields are optional):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"seeds: [ExtImport]")),(0,r.kt)("p",{parentName:"li"},"Defines the seed functions you can use with the ",(0,r.kt)("inlineCode",{parentName:"p"},"wasp db seed")," command to seed your database with initial data.\nRead the ",(0,r.kt)("a",{parentName:"p",href:"#seeding-the-database"},"Seeding section")," for more details."))),(0,r.kt)("h3",{id:"cli-commands-for-seeding-the-database"},"CLI Commands for Seeding the Database"),(0,r.kt)("p",null,"Use one of the following commands to run the seed functions:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"wasp db seed")),(0,r.kt)("p",{parentName:"li"},"If you've only defined a single seed function, this command runs it. If you've defined multiple seed functions, it asks you to choose one interactively.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"wasp db seed <seed-name>")),(0,r.kt)("p",{parentName:"li"},"This command runs the seed function with the specified name. The name is the identifier used in its ",(0,r.kt)("inlineCode",{parentName:"p"},"import")," expression in the ",(0,r.kt)("inlineCode",{parentName:"p"},"app.db.seeds")," list.\nFor example, to run the seed function ",(0,r.kt)("inlineCode",{parentName:"p"},"devSeedSimple")," which was defined like this:"),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:"title=main.wasp",title:"main.wasp"},'app MyApp {\n  // ...\n  db: {\n    seeds: [\n      // ...\n      import { devSeedSimple } from "@src/dbSeeds.js",\n    ]\n  }\n}\n'))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:"title=main.wasp",title:"main.wasp"},'app MyApp {\n  // ...\n  db: {\n    seeds: [\n      // ...\n      import { devSeedSimple } from "@src/dbSeeds.js",\n    ]\n  }\n}\n')))),(0,r.kt)("p",{parentName:"li"},"Use the following command:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"wasp db seed devSeedSimple\n")))))}h.isMDXComponent=!0}}]);