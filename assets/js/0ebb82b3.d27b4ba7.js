"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[36475],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var o=a.createContext({}),u=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(o.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,s=e.originalType,o=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=u(n),c=i,h=p["".concat(o,".").concat(c)]||p[c]||m[c]||s;return n?a.createElement(h,r(r({ref:t},d),{},{components:n})):a.createElement(h,r({ref:t},d))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var s=n.length,r=new Array(s);r[0]=c;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l[p]="string"==typeof e?e:i,r[1]=l;for(var u=2;u<s;u++)r[u]=n[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},38610:(e,t,n)=>{n.d(t,{Z:()=>s});var a=n(67294),i=n(44996);const s=e=>a.createElement("div",null,a.createElement("p",{align:"center"},a.createElement("figure",null,a.createElement("img",{style:{width:e.width},alt:e.alt,src:(0,i.Z)(e.source)}),a.createElement("figcaption",{class:"image-caption",style:{fontStyle:"italic",opacity:.6,fontSize:"0.9rem"}},e.caption))))},85162:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(67294),i=n(86010);const s={tabItem:"tabItem_Ymn6"};function r(e){let{children:t,hidden:n,className:r}=e;return a.createElement("div",{role:"tabpanel",className:(0,i.Z)(s.tabItem,r),hidden:n},t)}},74866:(e,t,n)=>{n.d(t,{Z:()=>b});var a=n(87462),i=n(67294),s=n(86010),r=n(12466),l=n(16550),o=n(91980),u=n(67392),d=n(50012);function p(e){return function(e){return i.Children.map(e,(e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:i}}=e;return{value:t,label:n,attributes:a,default:i}}))}function m(e){const{values:t,children:n}=e;return(0,i.useMemo)((()=>{const e=t??p(n);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function c(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function h(e){let{queryString:t=!1,groupId:n}=e;const a=(0,l.k6)(),s=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,o._X)(s),(0,i.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(a.location.search);t.set(s,e),a.replace({...a.location,search:t.toString()})}),[s,a])]}function k(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,s=m(e),[r,l]=(0,i.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!c({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:s}))),[o,u]=h({queryString:n,groupId:a}),[p,k]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,s]=(0,d.Nk)(n);return[a,(0,i.useCallback)((e=>{n&&s.set(e)}),[n,s])]}({groupId:a}),g=(()=>{const e=o??p;return c({value:e,tabValues:s})?e:null})();(0,i.useLayoutEffect)((()=>{g&&l(g)}),[g]);return{selectedValue:r,selectValue:(0,i.useCallback)((e=>{if(!c({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),k(e)}),[u,k,s]),tabValues:s}}var g=n(72389);const y={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function f(e){let{className:t,block:n,selectedValue:l,selectValue:o,tabValues:u}=e;const d=[],{blockElementScrollPositionUntilNextRender:p}=(0,r.o5)(),m=e=>{const t=e.currentTarget,n=d.indexOf(t),a=u[n].value;a!==l&&(p(t),o(a))},c=e=>{let t=null;switch(e.key){case"Enter":m(e);break;case"ArrowRight":{const n=d.indexOf(e.currentTarget)+1;t=d[n]??d[0];break}case"ArrowLeft":{const n=d.indexOf(e.currentTarget)-1;t=d[n]??d[d.length-1];break}}t?.focus()};return i.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":n},t)},u.map((e=>{let{value:t,label:n,attributes:r}=e;return i.createElement("li",(0,a.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>d.push(e),onKeyDown:c,onClick:m},r,{className:(0,s.Z)("tabs__item",y.tabItem,r?.className,{"tabs__item--active":l===t})}),n??t)})))}function N(e){let{lazy:t,children:n,selectedValue:a}=e;const s=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=s.find((e=>e.props.value===a));return e?(0,i.cloneElement)(e,{className:"margin-top--md"}):null}return i.createElement("div",{className:"margin-top--md"},s.map(((e,t)=>(0,i.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function v(e){const t=k(e);return i.createElement("div",{className:(0,s.Z)("tabs-container",y.tabList)},i.createElement(f,(0,a.Z)({},e,t)),i.createElement(N,(0,a.Z)({},e,t)))}function b(e){const t=(0,g.Z)();return i.createElement(v,(0,a.Z)({key:String(t)},e))}},46300:(e,t,n)=>{n.d(t,{Z:()=>s});var a=n(67294),i=n(50012);function s(e){let{path:t}=e;const[n]=(0,i.Nk)("docusaurus.tab.js-ts"),s=t.lastIndexOf("{"),r=t.slice(s+1,t.length-1),[l,o]=r.split(","),u=t.slice(0,s);return a.createElement("code",null,u+("js"===n?l:o))}},87587:(e,t,n)=>{n.d(t,{Fi:()=>l,Jp:()=>s,Vp:()=>i,aH:()=>r});var a=n(67294);const i=e=>{let{color:t,children:n}=e;return a.createElement("span",{style:{border:`2px solid ${t}`,display:"inline-block",padding:"0.2em 0.4em",color:t,borderRadius:"0.4em",fontSize:"0.8em",lineHeight:"1",fontWeight:"bold"}},n)};function s(){return a.createElement(i,{color:"#0b62f5"},"internal")}function r(){return a.createElement(i,{color:"#f59e0b"},"required")}function l(){return a.createElement(i,{color:"#08c47e"},"optional")}},76040:(e,t,n)=>{n.d(t,{ZP:()=>l});var a=n(87462),i=(n(67294),n(3905));n(46300);const s={toc:[]},r="wrapper";function l(e){let{components:t,...n}=e;return(0,i.kt)(r,(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("admonition",{title:"Using multiple auth identities for a single user",type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Wasp currently doesn't support multiple auth identities for a single user. This means, for example, that a user can't have both an email-based auth identity and a Google-based auth identity. This is something we will add in the future with the introduction of the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/wasp-lang/wasp/issues/954"},"account merging feature"),"."),(0,i.kt)("p",{parentName:"admonition"},"Account merging means that multiple auth identities can be merged into a single user account. For example, a user's email and Google identity can be merged into a single user account. Then the user can log in with either their email or Google account and they will be logged into the same account.")))}l.isMDXComponent=!0},84890:(e,t,n)=>{n.d(t,{ZP:()=>l});var a=n(87462),i=(n(67294),n(3905));n(46300);const s={toc:[]},r="wrapper";function l(e){let{components:t,...n}=e;return(0,i.kt)(r,(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'const discordIdentity = user.identities.discord\n\n// Discord User ID for example "80351110224678912"\ndiscordIdentity.id\n')))}l.isMDXComponent=!0},9358:(e,t,n)=>{n.d(t,{ZP:()=>l});var a=n(87462),i=(n(67294),n(3905));n(46300);const s={toc:[]},r="wrapper";function l(e){let{components:t,...n}=e;return(0,i.kt)(r,(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'const emailIdentity = user.identities.email\n\n// Email address the user used to sign up, e.g. "fluffyllama@app.com".\nemailIdentity.id\n\n// `true` if the user has verified their email address.\nemailIdentity.isEmailVerified\n\n// Datetime when the email verification email was sent.\nemailIdentity.emailVerificationSentAt\n\n// Datetime when the last password reset email was sent.\nemailIdentity.passwordResetSentAt\n')))}l.isMDXComponent=!0},28866:(e,t,n)=>{n.d(t,{ZP:()=>l});var a=n(87462),i=(n(67294),n(3905));n(46300);const s={toc:[]},r="wrapper";function l(e){let{components:t,...n}=e;return(0,i.kt)(r,(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'const githubIdentity = user.identities.github\n\n// GitHub User ID for example "12345678"\ngithubIdentity.id\n')))}l.isMDXComponent=!0},87172:(e,t,n)=>{n.d(t,{ZP:()=>l});var a=n(87462),i=(n(67294),n(3905));n(46300);const s={toc:[]},r="wrapper";function l(e){let{components:t,...n}=e;return(0,i.kt)(r,(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'const googleIdentity = user.identities.google\n\n// Google User ID for example "123456789012345678901"\ngoogleIdentity.id\n')))}l.isMDXComponent=!0},90466:(e,t,n)=>{n.d(t,{ZP:()=>l});var a=n(87462),i=(n(67294),n(3905));n(46300);const s={toc:[]},r="wrapper";function l(e){let{components:t,...n}=e;return(0,i.kt)(r,(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'const keycloakIdentity = user.identities.keycloak\n\n// Keycloak User ID for example "12345678-1234-1234-1234-123456789012"\nkeycloakIdentity.id\n')))}l.isMDXComponent=!0},69761:(e,t,n)=>{n.d(t,{ZP:()=>l});var a=n(87462),i=(n(67294),n(3905));n(46300);const s={toc:[]},r="wrapper";function l(e){let{components:t,...n}=e;return(0,i.kt)(r,(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'const usernameIdentity = user.identities.username\n\n// Username that the user used to sign up, e.g. "fluffyllama"\nusernameIdentity.id\n')))}l.isMDXComponent=!0},51955:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>N,contentTitle:()=>y,default:()=>I,frontMatter:()=>g,metadata:()=>f,toc:()=>v});var a=n(87462),i=(n(67294),n(3905)),s=(n(46300),n(85162)),r=n(74866),l=n(38610),o=n(87587),u=n(76040),d=n(69761),p=n(9358),m=n(87172),c=n(28866),h=n(90466),k=n(84890);const g={title:"Accessing User Data"},y=void 0,f={unversionedId:"auth/entities/entities",id:"version-0.16.0/auth/entities/entities",title:"Accessing User Data",description:"First, we'll check out the most practical info: how to access the user's data in your app.",source:"@site/versioned_docs/version-0.16.0/auth/entities/entities.md",sourceDirName:"auth/entities",slug:"/auth/entities/",permalink:"/docs/auth/entities/",draft:!1,editUrl:"https://github.com/wasp-lang/wasp/edit/release/web/versioned_docs/version-0.16.0/auth/entities/entities.md",tags:[],version:"0.16.0",frontMatter:{title:"Accessing User Data"},sidebar:"docs",previous:{title:"Discord",permalink:"/docs/auth/social-auth/discord"},next:{title:"Auth Hooks",permalink:"/docs/auth/auth-hooks"}},N={},v=[{value:"Accessing the Auth Fields",id:"accessing-the-auth-fields",level:2},{value:"<code>AuthUser</code> Object Fields",id:"authuser-object-fields",level:3},{value:"<code>getFirstProviderUserId</code> Helper",id:"getfirstprovideruserid-helper",level:3},{value:"Including the User with Other Entities",id:"including-the-user-with-other-entities",level:2},{value:"Getting Auth Data from the User Object",id:"getting-auth-data-from-the-user-object",level:3},{value:"<code>getUsername</code>",id:"getusername",level:4},{value:"<code>getEmail</code>",id:"getemail",level:4},{value:"<code>getFirstProviderUserId</code>",id:"getfirstprovideruserid",level:4},{value:"Entities Explained",id:"entities-explained",level:2},{value:"User Entity",id:"user-entity",level:3},{value:"Example App Model",id:"example-app-model",level:3},{value:"<code>Auth</code> Entity <Internal />",id:"auth-entity-",level:3},{value:"<code>AuthIdentity</code> Entity <Internal />",id:"authidentity-entity-",level:3},{value:"<code>Session</code> Entity <Internal />",id:"session-entity-",level:3},{value:"Custom Signup Action",id:"custom-signup-action",level:2}],b={toc:v},w="wrapper";function I(e){let{components:t,...n}=e;return(0,i.kt)(w,(0,a.Z)({},b,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"First, we'll check out the most practical info: ",(0,i.kt)("strong",{parentName:"p"},"how to access the user's data in your app"),"."),(0,i.kt)("p",null,"Then, we'll dive into the details of the ",(0,i.kt)("strong",{parentName:"p"},"auth entities")," that Wasp creates behind the scenes to store the user's data. For auth each method, Wasp needs to store different information about the user. For example, username for ",(0,i.kt)("a",{parentName:"p",href:"./username-and-pass"},"Username & password")," auth, email verification status for ",(0,i.kt)("a",{parentName:"p",href:"./email"},"Email")," auth, and so on."),(0,i.kt)("p",null,"We'll also show you how you can use these entities to create a custom signup action."),(0,i.kt)("h2",{id:"accessing-the-auth-fields"},"Accessing the Auth Fields"),(0,i.kt)("p",null,"When you receive the ",(0,i.kt)("inlineCode",{parentName:"p"},"user")," object ",(0,i.kt)("a",{parentName:"p",href:"/docs/auth/overview#accessing-the-logged-in-user"},"on the client or the server"),", it will contain all the user fields you defined in the ",(0,i.kt)("inlineCode",{parentName:"p"},"User")," entity in the ",(0,i.kt)("inlineCode",{parentName:"p"},"schema.prisma")," file. In addition to that, it will also contain all the auth-related fields that Wasp stores. This includes things like the ",(0,i.kt)("inlineCode",{parentName:"p"},"username")," or the email verification status. In Wasp, this data is called the ",(0,i.kt)("inlineCode",{parentName:"p"},"AuthUser")," object."),(0,i.kt)("h3",{id:"authuser-object-fields"},(0,i.kt)("inlineCode",{parentName:"h3"},"AuthUser")," Object Fields"),(0,i.kt)("p",null,"All the ",(0,i.kt)("inlineCode",{parentName:"p"},"User")," fields you defined will be present at the top level of the ",(0,i.kt)("inlineCode",{parentName:"p"},"AuthUser")," object. The auth-related fields will be on the ",(0,i.kt)("inlineCode",{parentName:"p"},"identities")," object. For each auth method you enable, there will be a separate data object in the ",(0,i.kt)("inlineCode",{parentName:"p"},"identities")," object."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"AuthUser")," object will change depending on which auth method you have enabled in the Wasp file. For example, if you enabled the email auth and Google auth, it would look something like this:"),(0,i.kt)(r.Z,{mdxType:"Tabs"},(0,i.kt)(s.Z,{value:"google",label:"User Signed Up with Google",mdxType:"TabItem"},(0,i.kt)("p",null,"If the user has only the Google identity, the ",(0,i.kt)("inlineCode",{parentName:"p"},"AuthUser")," object will look like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"const user = {\n  // User data\n  id: 'cluqs9qyh00007cn73apj4hp7',\n  address: 'Some address',\n\n  // Auth methods specific data\n  identities: {\n    email: null,\n    google: {\n      id: '1117XXXX1301972049448',\n    },\n  },\n}\n"))),(0,i.kt)(s.Z,{value:"email",label:"User Signed Up with Email",mdxType:"TabItem"},(0,i.kt)("p",null,"If the user has only the email identity, the ",(0,i.kt)("inlineCode",{parentName:"p"},"AuthUser")," object will look like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"const user = {\n  // User data\n  id: 'cluqsex9500017cn7i2hwsg17',\n  address: 'Some address',\n\n  // Auth methods specific data\n  identities: {\n    email: {\n      id: 'user@app.com',\n      isEmailVerified: true,\n      emailVerificationSentAt: '2024-04-08T10:06:02.204Z',\n      passwordResetSentAt: null,\n    },\n    google: null,\n  },\n}\n")))),(0,i.kt)("p",null,"In the examples above, you can see the ",(0,i.kt)("inlineCode",{parentName:"p"},"identities")," object contains the ",(0,i.kt)("inlineCode",{parentName:"p"},"email")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"google")," objects. The ",(0,i.kt)("inlineCode",{parentName:"p"},"email")," object contains the email-related data and the ",(0,i.kt)("inlineCode",{parentName:"p"},"google")," object contains the Google-related data."),(0,i.kt)("admonition",{title:"Make sure to check if the data exists",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Before accessing some auth method's data, you'll need to check if that data exists for the user and then access it:"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"if (user.identities.google !== null) {\n  const userId = user.identities.google.id\n  // ...\n}\n")),(0,i.kt)("p",{parentName:"admonition"},"You need to do this because if a user didn't sign up with some auth method, the data for that auth method will be ",(0,i.kt)("inlineCode",{parentName:"p"},"null"),".")),(0,i.kt)("p",null,"Let's look at the data for each of the available auth methods:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"/docs/auth/username-and-pass"},"Username & password")," data"),(0,i.kt)(d.ZP,{mdxType:"UsernameData"})),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"/docs/auth/email"},"Email")," data"),(0,i.kt)(p.ZP,{mdxType:"EmailData"})),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"/docs/auth/social-auth/google"},"Google")," data"),(0,i.kt)(m.ZP,{mdxType:"GoogleData"})),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"/docs/auth/social-auth/github"},"GitHub")," data"),(0,i.kt)(c.ZP,{mdxType:"GithubData"})),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"/docs/auth/social-auth/keycloak"},"Keycloak")," data"),(0,i.kt)(h.ZP,{mdxType:"KeycloakData"})),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"/docs/auth/social-auth/discord"},"Discord")," data"),(0,i.kt)(k.ZP,{mdxType:"DiscordData"}))),(0,i.kt)("p",null,"If you support multiple auth methods, you'll need to find which identity exists for the user and then access its data:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"if (user.identities.email !== null) {\n  const email = user.identities.email.id\n  // ...\n} else if (user.identities.google !== null) {\n  const googleId = user.identities.google.id\n  // ...\n}\n")),(0,i.kt)("h3",{id:"getfirstprovideruserid-helper"},(0,i.kt)("inlineCode",{parentName:"h3"},"getFirstProviderUserId")," Helper"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"getFirstProviderUserId")," method returns the first user ID that it finds for the user. For example if the user has signed up with email, it will return the email. If the user has signed up with Google, it will return the Google ID."),(0,i.kt)("p",null,"This can be useful if you support multiple authentication methods and you need ",(0,i.kt)("em",{parentName:"p"},"any")," ID that identifies the user in your app."),(0,i.kt)(r.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(s.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/MainPage.jsx"',title:'"src/MainPage.jsx"'},"const MainPage = ({ user }) => {\n  const userId = user.getFirstProviderUserId()\n  // ...\n}\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:"title=src/tasks.js",title:"src/tasks.js"},"export const createTask = async (args, context) => {\n  const userId = context.user.getFirstProviderUserId()\n  // ...\n}\n"))),(0,i.kt)(s.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/MainPage.tsx"',title:'"src/MainPage.tsx"'},"import { type AuthUser } from 'wasp/auth'\n\nconst MainPage = ({ user }: { user: AuthUser }) => {\n  const userId = user.getFirstProviderUserId()\n  // ...\n}\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title=src/tasks.ts",title:"src/tasks.ts"},"export const createTask: CreateTask<...>  = async (args, context) => {\n  const userId = context.user.getFirstProviderUserId()\n  // ...\n}\n")))),(0,i.kt)("small",null,(0,i.kt)("p",null,"*"," Multiple identities per user will be possible in the future and then the ",(0,i.kt)("inlineCode",{parentName:"p"},"getFirstProviderUserId")," method will return the ID of the first identity that it finds without any guarantees about which one it will be.")),(0,i.kt)("h2",{id:"including-the-user-with-other-entities"},"Including the User with Other Entities"),(0,i.kt)("p",null,"Sometimes, you might want to include the user's data when fetching other entities. For example, you might want to include the user's data with the tasks they have created."),(0,i.kt)("p",null,"We'll mention the ",(0,i.kt)("inlineCode",{parentName:"p"},"auth")," and the ",(0,i.kt)("inlineCode",{parentName:"p"},"identities")," relations which we will explain in more detail later in the ",(0,i.kt)("a",{parentName:"p",href:"#entities-explained"},"Entities Explained")," section."),(0,i.kt)("admonition",{title:"Be careful about sensitive data",type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"You'll need to include the ",(0,i.kt)("inlineCode",{parentName:"p"},"auth")," and the ",(0,i.kt)("inlineCode",{parentName:"p"},"identities")," relations to get the full auth data about the user. However, you should keep in mind that the ",(0,i.kt)("inlineCode",{parentName:"p"},"providerData")," field in the ",(0,i.kt)("inlineCode",{parentName:"p"},"identities")," can contain sensitive data like the user's hashed password (in case of email or username auth), so you will likely want to exclude it if you are returning those values to the client.")),(0,i.kt)("p",null,"You can include the full user's data with other entities using the ",(0,i.kt)("inlineCode",{parentName:"p"},"include")," option in the Prisma queries:"),(0,i.kt)(r.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(s.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/tasks.js"',title:'"src/tasks.js"'},"export const getAllTasks = async (args, context) => {\n  return context.entities.Task.findMany({\n    orderBy: { id: 'desc' },\n    select: {\n      id: true,\n      title: true,\n      // highlight-next-line\n      user: {\n        include: {\n          // highlight-next-line\n          auth: {\n            include: {\n              // highlight-next-line\n              identities: {\n                // Including only the `providerName` and `providerUserId` fields\n                select: {\n                  providerName: true,\n                  providerUserId: true,\n                },\n              },\n            },\n          },\n        },\n      },\n    },\n  })\n}\n"))),(0,i.kt)(s.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/tasks.ts"',title:'"src/tasks.ts"'},"export const getAllTasks = (async (args, context) => {\n  return context.entities.Task.findMany({\n    orderBy: { id: 'desc' },\n    select: {\n      id: true,\n      title: true,\n      // highlight-next-line\n      user: {\n        include: {\n          // highlight-next-line\n          auth: {\n            include: {\n              // highlight-next-line\n              identities: {\n                // Including only the `providerName` and `providerUserId` fields\n                select: {\n                  providerName: true,\n                  providerUserId: true,\n                },\n              },\n            },\n          },\n        },\n      },\n    },\n  })\n}) satisfies tasks.GetAllQuery<{}, {}>\n")))),(0,i.kt)("p",null,"If you have some ",(0,i.kt)("strong",{parentName:"p"},"piece of the auth data that you want to access frequently")," (for example the ",(0,i.kt)("inlineCode",{parentName:"p"},"username"),"), it's best to store it at the top level of the ",(0,i.kt)("inlineCode",{parentName:"p"},"User")," entity."),(0,i.kt)("p",null,"For example, save the ",(0,i.kt)("inlineCode",{parentName:"p"},"username")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"email")," as a property on the ",(0,i.kt)("inlineCode",{parentName:"p"},"User")," and you'll be able to access it without including the ",(0,i.kt)("inlineCode",{parentName:"p"},"auth")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"identities")," fields. We show an example in the ",(0,i.kt)("a",{parentName:"p",href:"/docs/auth/overview#1-defining-extra-fields"},"Defining Extra Fields on the User Entity")," section of the docs."),(0,i.kt)("h3",{id:"getting-auth-data-from-the-user-object"},"Getting Auth Data from the User Object"),(0,i.kt)("p",null,"When you have the ",(0,i.kt)("inlineCode",{parentName:"p"},"user")," object with the ",(0,i.kt)("inlineCode",{parentName:"p"},"auth")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"identities")," fields, it can be a bit tedious to obtain the auth data (like username or Google ID) from it:"),(0,i.kt)(r.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(s.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/MainPage.jsx"',title:'"src/MainPage.jsx"'},'function MainPage() {\n  // ...\n  return (\n    <div className="tasks">\n      {tasks.map((task) => (\n        <div key={task.id} className="task">\n          {task.title} by {task.user.auth?.identities[0].providerUserId}\n        </div>\n      ))}\n    </div>\n  )\n}\n'))),(0,i.kt)(s.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/MainPage.tsx"',title:'"src/MainPage.tsx"'},'function MainPage() {\n  // ...\n  return (\n    <div className="tasks">\n      {tasks.map((task) => (\n        <div key={task.id} className="task">\n          {task.title} by {task.user.auth?.identities[0].providerUserId}\n        </div>\n      ))}\n    </div>\n  )\n}\n')))),(0,i.kt)("p",null,"Wasp offers a few helper methods to access the user's auth data when you retrieve the ",(0,i.kt)("inlineCode",{parentName:"p"},"user")," like this. They are ",(0,i.kt)("inlineCode",{parentName:"p"},"getUsername"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"getEmail")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"getFirstProviderUserId"),". They can be used both on the client and the server."),(0,i.kt)("h4",{id:"getusername"},(0,i.kt)("inlineCode",{parentName:"h4"},"getUsername")),(0,i.kt)("p",null,"It accepts the ",(0,i.kt)("inlineCode",{parentName:"p"},"user")," object and if the user signed up with the ",(0,i.kt)("a",{parentName:"p",href:"./username-and-pass"},"Username & password")," auth method, it returns the username or ",(0,i.kt)("inlineCode",{parentName:"p"},"null")," otherwise. The ",(0,i.kt)("inlineCode",{parentName:"p"},"user")," object needs to have the ",(0,i.kt)("inlineCode",{parentName:"p"},"auth")," and the ",(0,i.kt)("inlineCode",{parentName:"p"},"identities")," relations included."),(0,i.kt)(r.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(s.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/MainPage.jsx"',title:'"src/MainPage.jsx"'},'import { getUsername } from \'wasp/auth\'\n\nfunction MainPage() {\n  // ...\n  return (\n    <div className="tasks">\n      {tasks.map((task) => (\n        <div key={task.id} className="task">\n          {task.title} by {getUsername(task.user)}\n        </div>\n      ))}\n    </div>\n  )\n}\n'))),(0,i.kt)(s.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/MainPage.tsx"',title:'"src/MainPage.tsx"'},'import { getUsername } from \'wasp/auth\'\n\nfunction MainPage() {\n  // ...\n  return (\n    <div className="tasks">\n      {tasks.map((task) => (\n        <div key={task.id} className="task">\n          {task.title} by {getUsername(task.user)}\n        </div>\n      ))}\n    </div>\n  )\n}\n')))),(0,i.kt)("h4",{id:"getemail"},(0,i.kt)("inlineCode",{parentName:"h4"},"getEmail")),(0,i.kt)("p",null,"It accepts the ",(0,i.kt)("inlineCode",{parentName:"p"},"user")," object and if the user signed up with the ",(0,i.kt)("a",{parentName:"p",href:"./email"},"Email")," auth method, it returns the email or ",(0,i.kt)("inlineCode",{parentName:"p"},"null")," otherwise. The ",(0,i.kt)("inlineCode",{parentName:"p"},"user")," object needs to have the ",(0,i.kt)("inlineCode",{parentName:"p"},"auth")," and the ",(0,i.kt)("inlineCode",{parentName:"p"},"identities")," relations included."),(0,i.kt)(r.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(s.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/MainPage.jsx"',title:'"src/MainPage.jsx"'},'import { getEmail } from \'wasp/auth\'\n\nfunction MainPage() {\n  // ...\n  return (\n    <div className="tasks">\n      {tasks.map((task) => (\n        <div key={task.id} className="task">\n          {task.title} by {getEmail(task.user)}\n        </div>\n      ))}\n    </div>\n  )\n}\n'))),(0,i.kt)(s.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/MainPage.tsx"',title:'"src/MainPage.tsx"'},'import { getEmail } from \'wasp/auth\'\n\nfunction MainPage() {\n  // ...\n  return (\n    <div className="tasks">\n      {tasks.map((task) => (\n        <div key={task.id} className="task">\n          {task.title} by {getEmail(task.user)}\n        </div>\n      ))}\n    </div>\n  )\n}\n')))),(0,i.kt)("h4",{id:"getfirstprovideruserid"},(0,i.kt)("inlineCode",{parentName:"h4"},"getFirstProviderUserId")),(0,i.kt)("p",null,"It returns the first user ID that it finds for the user. For example if the user has signed up with email, it will return the email. If the user has signed up with Google, it will return the Google ID. The ",(0,i.kt)("inlineCode",{parentName:"p"},"user")," object needs to have the ",(0,i.kt)("inlineCode",{parentName:"p"},"auth")," and the ",(0,i.kt)("inlineCode",{parentName:"p"},"identities")," relations included."),(0,i.kt)(r.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(s.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/MainPage.jsx"',title:'"src/MainPage.jsx"'},'import { getFirstProviderUserId } from \'wasp/auth\'\n\nfunction MainPage() {\n  // ...\n  return (\n    <div className="tasks">\n      {tasks.map((task) => (\n        <div key={task.id} className="task">\n          {task.title} by {getFirstProviderUserId(task.user)}\n        </div>\n      ))}\n    </div>\n  )\n}\n'))),(0,i.kt)(s.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/MainPage.tsx"',title:'"src/MainPage.tsx"'},'import { getFirstProviderUserId } from \'wasp/auth\'\n\nfunction MainPage() {\n  // ...\n  return (\n    <div className="tasks">\n      {tasks.map((task) => (\n        <div key={task.id} className="task">\n          {task.title} by {getFirstProviderUserId(task.user)}\n        </div>\n      ))}\n    </div>\n  )\n}\n')))),(0,i.kt)("h2",{id:"entities-explained"},"Entities Explained"),(0,i.kt)("p",null,"To store user's auth information, Wasp does a few things behind the scenes. Wasp takes your ",(0,i.kt)("inlineCode",{parentName:"p"},"schema.prisma")," file and combines it with additional entities to create the final ",(0,i.kt)("inlineCode",{parentName:"p"},"schema.prisma")," file that is used in your app."),(0,i.kt)("p",null,"In this section, we will explain which entities are created and how they are connected."),(0,i.kt)("h3",{id:"user-entity"},"User Entity"),(0,i.kt)("p",null,"When you want to add authentication to your app, you need to specify the ",(0,i.kt)("inlineCode",{parentName:"p"},"userEntity")," field."),(0,i.kt)("p",null,"For example, you might set it to ",(0,i.kt)("inlineCode",{parentName:"p"},"User"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'app myApp {\n  wasp: {\n    version: "^0.16.0"\n  },\n  title: "My App",\n  auth: {\n    // highlight-next-line\n    userEntity: User,\n    // ...\n  },\n}\n')),(0,i.kt)("p",null,"And define the ",(0,i.kt)("inlineCode",{parentName:"p"},"User")," in the ",(0,i.kt)("inlineCode",{parentName:"p"},"schema.prisma")," file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-prisma",metastring:'title="schema.prisma"',title:'"schema.prisma"'},"model User {\n  id Int @id @default(autoincrement())\n  // Any other fields you want to store about the user\n}\n")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"User"),' entity is a "business logic user" which represents a user of your app.'),(0,i.kt)("p",null,"You can use this entity to store any information about the user that you want to store. For example, you might want to store the user's name or address."),(0,i.kt)("p",null,"You can also use the user entity to define the relations between users and other entities in your app. For example, you might want to define a relation between a user and the tasks that they have created."),(0,i.kt)("p",null,"You ",(0,i.kt)("strong",{parentName:"p"},"own")," the user entity and you can modify it as you wish. You can add new fields to it, remove fields from it, or change the type of the fields. You can also add new relations to it or remove existing relations from it."),(0,i.kt)(l.Z,{alt:"Auth Entities in a Wasp App",source:"img/auth-entities/model.png",caption:"Auth Entities in a Wasp App",mdxType:"ImgWithCaption"}),(0,i.kt)("p",null,"On the other hand, the ",(0,i.kt)("inlineCode",{parentName:"p"},"Auth"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"AuthIdentity")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Session")," entities are created behind the scenes and are used to store the user's login credentials. You as the developer don't need to care about this entity most of the time. Wasp ",(0,i.kt)("strong",{parentName:"p"},"owns")," these entities."),(0,i.kt)("p",null,"In the case you want to create a custom signup action, you will need to use the ",(0,i.kt)("inlineCode",{parentName:"p"},"Auth")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"AuthIdentity")," entities directly."),(0,i.kt)("h3",{id:"example-app-model"},"Example App Model"),(0,i.kt)("p",null,"Let's imagine we created a simple tasks management app:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The app has email and Google-based auth."),(0,i.kt)("li",{parentName:"ul"},"Users can create tasks and see the tasks that they have created.")),(0,i.kt)("p",null,"Let's look at how would that look in the database:"),(0,i.kt)(l.Z,{alt:"Example of Auth Entities",source:"img/auth-entities/model-example.png",caption:"Example of Auth Entities",mdxType:"ImgWithCaption"}),(0,i.kt)("p",null,"If we take a look at an example user in the database, we can see:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The business logic user, ",(0,i.kt)("inlineCode",{parentName:"li"},"User")," is connected to multiple ",(0,i.kt)("inlineCode",{parentName:"li"},"Task")," entities.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},'In this example, "Example User" has two tasks.'))),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"User")," is connected to exactly one ",(0,i.kt)("inlineCode",{parentName:"li"},"Auth")," entity."),(0,i.kt)("li",{parentName:"ul"},"Each ",(0,i.kt)("inlineCode",{parentName:"li"},"Auth")," entity can have multiple ",(0,i.kt)("inlineCode",{parentName:"li"},"AuthIdentity")," entities.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"In this example, the ",(0,i.kt)("inlineCode",{parentName:"li"},"Auth")," entity has two ",(0,i.kt)("inlineCode",{parentName:"li"},"AuthIdentity")," entities: one for the email-based auth and one for the Google-based auth."))),(0,i.kt)("li",{parentName:"ul"},"Each ",(0,i.kt)("inlineCode",{parentName:"li"},"Auth")," entity can have multiple ",(0,i.kt)("inlineCode",{parentName:"li"},"Session")," entities.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"In this example, the ",(0,i.kt)("inlineCode",{parentName:"li"},"Auth")," entity has one ",(0,i.kt)("inlineCode",{parentName:"li"},"Session")," entity.")))),(0,i.kt)(u.ZP,{mdxType:"MultipleIdentitiesWarning"}),(0,i.kt)("h3",{id:"auth-entity-"},(0,i.kt)("inlineCode",{parentName:"h3"},"Auth")," Entity ",(0,i.kt)(o.Jp,{mdxType:"Internal"})),(0,i.kt)("p",null,"Wasp's internal ",(0,i.kt)("inlineCode",{parentName:"p"},"Auth")," entity is used to connect the business logic user, ",(0,i.kt)("inlineCode",{parentName:"p"},"User")," with the user's login credentials."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-prisma"},"model Auth {\n  id         String         @id @default(uuid())\n  userId     Int?           @unique\n  // Wasp injects this relation on the User entity as well\n  user       User?          @relation(fields: [userId], references: [id], onDelete: Cascade)\n  identities AuthIdentity[]\n  sessions   Session[]\n}\n")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"Auth")," fields:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"id")," is a unique identifier of the ",(0,i.kt)("inlineCode",{parentName:"li"},"Auth")," entity."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"userId")," is a foreign key to the ",(0,i.kt)("inlineCode",{parentName:"li"},"User")," entity.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"It is used to connect the ",(0,i.kt)("inlineCode",{parentName:"li"},"Auth")," entity with the business logic user."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"user")," is a relation to the ",(0,i.kt)("inlineCode",{parentName:"li"},"User")," entity.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"This relation is injected on the ",(0,i.kt)("inlineCode",{parentName:"li"},"User")," entity as well."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"identities")," is a relation to the ",(0,i.kt)("inlineCode",{parentName:"li"},"AuthIdentity")," entity."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"sessions")," is a relation to the ",(0,i.kt)("inlineCode",{parentName:"li"},"Session")," entity.")),(0,i.kt)("h3",{id:"authidentity-entity-"},(0,i.kt)("inlineCode",{parentName:"h3"},"AuthIdentity")," Entity ",(0,i.kt)(o.Jp,{mdxType:"Internal"})),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"AuthIdentity")," entity is used to store the user's login credentials for various authentication methods."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-prisma"},'model AuthIdentity {\n  providerName   String\n  providerUserId String\n  providerData   String @default("{}")\n  authId         String\n  auth           Auth   @relation(fields: [authId], references: [id], onDelete: Cascade)\n\n  @@id([providerName, providerUserId])\n}\n')),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"AuthIdentity")," fields:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"providerName")," is the name of the authentication provider.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"For example, ",(0,i.kt)("inlineCode",{parentName:"li"},"email")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"google"),"."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"providerUserId")," is the user's ID in the authentication provider.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"For example, the user's email or Google ID."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"providerData")," is a JSON string that contains additional data about the user from the authentication provider.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"For example, for password based auth, this field contains the user's hashed password."),(0,i.kt)("li",{parentName:"ul"},"This field is a ",(0,i.kt)("inlineCode",{parentName:"li"},"String")," and not a ",(0,i.kt)("inlineCode",{parentName:"li"},"Json")," type because ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/prisma/prisma/issues/3786"},"Prisma doesn't support the ",(0,i.kt)("inlineCode",{parentName:"a"},"Json")," type for SQLite"),"."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"authId")," is a foreign key to the ",(0,i.kt)("inlineCode",{parentName:"li"},"Auth")," entity.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"It is used to connect the ",(0,i.kt)("inlineCode",{parentName:"li"},"AuthIdentity")," entity with the ",(0,i.kt)("inlineCode",{parentName:"li"},"Auth")," entity."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"auth")," is a relation to the ",(0,i.kt)("inlineCode",{parentName:"li"},"Auth")," entity.")),(0,i.kt)("h3",{id:"session-entity-"},(0,i.kt)("inlineCode",{parentName:"h3"},"Session")," Entity ",(0,i.kt)(o.Jp,{mdxType:"Internal"})),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"Session")," entity is used to store the user's session information. It is used to keep the user logged in between page refreshes."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-prisma"},"model Session {\n  id        String   @id @unique\n  expiresAt DateTime\n  userId    String\n  auth      Auth     @relation(references: [id], fields: [userId], onDelete: Cascade)\n\n  @@index([userId])\n}\n")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"Session")," fields:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"id")," is a unique identifier of the ",(0,i.kt)("inlineCode",{parentName:"li"},"Session")," entity."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"expiresAt")," is the date when the session expires."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"userId")," is a foreign key to the ",(0,i.kt)("inlineCode",{parentName:"li"},"Auth")," entity.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"It is used to connect the ",(0,i.kt)("inlineCode",{parentName:"li"},"Session")," entity with the ",(0,i.kt)("inlineCode",{parentName:"li"},"Auth")," entity."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"auth")," is a relation to the ",(0,i.kt)("inlineCode",{parentName:"li"},"Auth")," entity.")),(0,i.kt)("h2",{id:"custom-signup-action"},"Custom Signup Action"),(0,i.kt)("p",null,"Let's take a look at how you can use the ",(0,i.kt)("inlineCode",{parentName:"p"},"Auth")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"AuthIdentity")," entities to create custom login and signup actions. For example, you might want to create a custom signup action that creates a user in your app and also creates a user in a third-party service."),(0,i.kt)("admonition",{title:"Custom Signup Examples",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"In the ",(0,i.kt)("a",{parentName:"p",href:"./email#creating-a-custom-sign-up-action"},"Email")," section of the docs we give you an example for custom email signup and in the ",(0,i.kt)("a",{parentName:"p",href:"./username-and-pass#2-creating-your-custom-sign-up-action"},"Username & password")," section of the docs we give you an example for custom username & password signup.")),(0,i.kt)("p",null,"Below is a simplified version of a custom signup action which you probably wouldn't use in your app but it shows you how you can use the ",(0,i.kt)("inlineCode",{parentName:"p"},"Auth")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"AuthIdentity")," entities to create a custom signup action."),(0,i.kt)(r.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(s.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'// ...\n\naction customSignup {\n  fn: import { signup } from "@src/auth/signup.js",\n  entities: [User]\n}\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/auth/signup.js"',title:'"src/auth/signup.js"'},"import {\n  createProviderId,\n  sanitizeAndSerializeProviderData,\n  createUser,\n} from 'wasp/server/auth'\n\nexport const signup = async (args, { entities: { User } }) => {\n  try {\n    // Provider ID is a combination of the provider name and the provider user ID\n    // And it is used to uniquely identify the user in your app\n    const providerId = createProviderId('username', args.username)\n    // sanitizeAndSerializeProviderData hashes the password and returns a JSON string\n    const providerData = await sanitizeAndSerializeProviderData({\n      hashedPassword: args.password,\n    })\n\n    await createUser(\n      providerId,\n      providerData,\n      // Any additional data you want to store on the User entity\n      {}\n    )\n\n    // This is equivalent to:\n    // await User.create({\n    //   data: {\n    //     auth: {\n    //       create: {\n    //         identities: {\n    //             create: {\n    //                 providerName: 'username',\n    //                 providerUserId: args.username\n    //                 providerData,\n    //             },\n    //         },\n    //       }\n    //     },\n    //   }\n    // })\n  } catch (e) {\n    return {\n      success: false,\n      message: e.message,\n    }\n  }\n\n  // Your custom code after sign-up.\n  // ...\n\n  return {\n    success: true,\n    message: 'User created successfully',\n  }\n}\n"))),(0,i.kt)(s.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'// ...\n\naction customSignup {\n  fn: import { signup } from "@src/auth/signup.js",\n  entities: [User]\n}\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/auth/signup.ts"',title:'"src/auth/signup.ts"'},"import {\n  createProviderId,\n  sanitizeAndSerializeProviderData,\n  createUser,\n} from 'wasp/server/auth'\nimport type { CustomSignup } from 'wasp/server/operations'\n\ntype CustomSignupInput = {\n  username: string\n  password: string\n}\ntype CustomSignupOutput = {\n  success: boolean\n  message: string\n}\n\nexport const signup: CustomSignup<\n  CustomSignupInput,\n  CustomSignupOutput\n> = async (args, { entities: { User } }) => {\n  try {\n    // Provider ID is a combination of the provider name and the provider user ID\n    // And it is used to uniquely identify the user in your app\n    const providerId = createProviderId('username', args.username)\n    // sanitizeAndSerializeProviderData hashes the password and returns a JSON string\n    const providerData = await sanitizeAndSerializeProviderData<'username'>({\n      hashedPassword: args.password,\n    })\n\n    await createUser(\n      providerId,\n      providerData,\n      // Any additional data you want to store on the User entity\n      {}\n    )\n\n    // This is equivalent to:\n    // await User.create({\n    //   data: {\n    //     auth: {\n    //       create: {\n    //         identities: {\n    //             create: {\n    //                 providerName: 'username',\n    //                 providerUserId: args.username\n    //                 providerData,\n    //             },\n    //         },\n    //       }\n    //     },\n    //   }\n    // })\n  } catch (e) {\n    return {\n      success: false,\n      message: e.message,\n    }\n  }\n\n  // Your custom code after sign-up.\n  // ...\n\n  return {\n    success: true,\n    message: 'User created successfully',\n  }\n}\n")))),(0,i.kt)("p",null,"You can use whichever method suits your needs better: either the ",(0,i.kt)("inlineCode",{parentName:"p"},"createUser")," function or Prisma's ",(0,i.kt)("inlineCode",{parentName:"p"},"User.create")," method. The ",(0,i.kt)("inlineCode",{parentName:"p"},"createUser")," function is a bit more convenient to use because it hides some of the complexity. On the other hand, the ",(0,i.kt)("inlineCode",{parentName:"p"},"User.create")," method gives you more control over the data that is stored in the ",(0,i.kt)("inlineCode",{parentName:"p"},"Auth")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"AuthIdentity")," entities."))}I.isMDXComponent=!0}}]);